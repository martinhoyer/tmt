
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">




        <link rel="prev" href="../execute/">


        <link rel="next" href="../finish/">


      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">



        <title>Report - tmt</title>



      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">












        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">

    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>






  </head>


    <body dir="ltr">


    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#report" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>






<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="tmt" class="md-header__button md-logo" aria-label="tmt" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">

      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tmt
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Report

          </span>
        </div>
      </div>
    </div>


      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>





        <label class="md-header__button md-icon" for="__search">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>



      <div class="md-header__source">
        <a href="https://github.com/teemtee/tmt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>

  </nav>

</header>

    <div class="md-container" data-md-component="container">






      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="tmt" class="md-nav__button md-logo" aria-label="tmt" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    tmt
  </label>

    <div class="md-nav__source">
      <a href="https://github.com/teemtee/tmt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>

  <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">



  <span class="md-ellipsis">
    Home

  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">



  <span class="md-ellipsis">
    Overview

  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../guide/" class="md-nav__link">



  <span class="md-ellipsis">
    Guide

  </span>


      </a>
    </li>
















    <li class="md-nav__item md-nav__item--active md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>


          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">



  <span class="md-ellipsis">
    Plugins

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../" class="md-nav__link">



  <span class="md-ellipsis">
    Overview

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../discover/" class="md-nav__link">



  <span class="md-ellipsis">
    Discover

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../provision/" class="md-nav__link">



  <span class="md-ellipsis">
    Provision

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../prepare/" class="md-nav__link">



  <span class="md-ellipsis">
    Prepare

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../execute/" class="md-nav__link">



  <span class="md-ellipsis">
    Execute

  </span>


      </a>
    </li>












    <li class="md-nav__item md-nav__item--active">

      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">





        <label class="md-nav__link md-nav__link--active" for="__toc">



  <span class="md-ellipsis">
    Report

  </span>


          <span class="md-nav__icon md-icon"></span>
        </label>

      <a href="./" class="md-nav__link md-nav__link--active">



  <span class="md-ellipsis">
    Report

  </span>


      </a>



<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#display" class="md-nav__link">
    <span class="md-ellipsis">
      display
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.display.ReportDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      ReportDisplay
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportDisplay">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.display.ReportDisplay.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    <span class="md-ellipsis">
      html
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.html.ReportHtml" class="md-nav__link">
    <span class="md-ellipsis">
      ReportHtml
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportHtml">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.html.ReportHtml.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#junit" class="md-nav__link">
    <span class="md-ellipsis">
      junit
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.junit.ReportJUnit" class="md-nav__link">
    <span class="md-ellipsis">
      ReportJUnit
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportJUnit">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.junit.ReportJUnit.check_options" class="md-nav__link">
    <span class="md-ellipsis">
      check_options
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.junit.ReportJUnit.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#polarion" class="md-nav__link">
    <span class="md-ellipsis">
      polarion
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.polarion.ReportPolarion" class="md-nav__link">
    <span class="md-ellipsis">
      ReportPolarion
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportPolarion">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.polarion.ReportPolarion.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#reportportal" class="md-nav__link">
    <span class="md-ellipsis">
      reportportal
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal" class="md-nav__link">
    <span class="md-ellipsis">
      ReportReportPortal
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportReportPortal">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.append_description" class="md-nav__link">
    <span class="md-ellipsis">
      append_description
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.append_link_template" class="md-nav__link">
    <span class="md-ellipsis">
      append_link_template
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.check_options" class="md-nav__link">
    <span class="md-ellipsis">
      check_options
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.execute_rp_import" class="md-nav__link">
    <span class="md-ellipsis">
      execute_rp_import
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.handle_response" class="md-nav__link">
    <span class="md-ellipsis">
      handle_response
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.upload_result_logs" class="md-nav__link">
    <span class="md-ellipsis">
      upload_result_logs
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>

    </li>










    <li class="md-nav__item">
      <a href="../finish/" class="md-nav__link">



  <span class="md-ellipsis">
    Finish

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#display" class="md-nav__link">
    <span class="md-ellipsis">
      display
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.display.ReportDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      ReportDisplay
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportDisplay">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.display.ReportDisplay.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    <span class="md-ellipsis">
      html
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.html.ReportHtml" class="md-nav__link">
    <span class="md-ellipsis">
      ReportHtml
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportHtml">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.html.ReportHtml.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#junit" class="md-nav__link">
    <span class="md-ellipsis">
      junit
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.junit.ReportJUnit" class="md-nav__link">
    <span class="md-ellipsis">
      ReportJUnit
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportJUnit">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.junit.ReportJUnit.check_options" class="md-nav__link">
    <span class="md-ellipsis">
      check_options
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.junit.ReportJUnit.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#polarion" class="md-nav__link">
    <span class="md-ellipsis">
      polarion
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.polarion.ReportPolarion" class="md-nav__link">
    <span class="md-ellipsis">
      ReportPolarion
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportPolarion">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.polarion.ReportPolarion.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#reportportal" class="md-nav__link">
    <span class="md-ellipsis">
      reportportal
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal" class="md-nav__link">
    <span class="md-ellipsis">
      ReportReportPortal
    </span>
  </a>

    <nav class="md-nav" aria-label="ReportReportPortal">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.append_description" class="md-nav__link">
    <span class="md-ellipsis">
      append_description
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.append_link_template" class="md-nav__link">
    <span class="md-ellipsis">
      append_link_template
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.check_options" class="md-nav__link">
    <span class="md-ellipsis">
      check_options
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.execute_rp_import" class="md-nav__link">
    <span class="md-ellipsis">
      execute_rp_import
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.handle_response" class="md-nav__link">
    <span class="md-ellipsis">
      handle_response
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.report.reportportal.ReportReportPortal.upload_result_logs" class="md-nav__link">
    <span class="md-ellipsis">
      upload_result_logs
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">








<h1 id="report">Report<a class="headerlink" href="#report" title="Permanent link">&para;</a></h1>
<p>Provide test results overview and send reports.</p>
<h2 id="display">display<a class="headerlink" href="#display" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.report.display.ReportDisplay" class="doc doc-heading">
            <code>tmt.steps.report.display.ReportDisplay</code>


<a href="#tmt.steps.report.display.ReportDisplay" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.report.ReportPlugin">ReportPlugin</span>[<span title="tmt.steps.report.display.ReportDisplayData">ReportDisplayData</span>]</code></p>


        <p>Show test results on the terminal.</p>
<p>Give a concise summary of test results directly on the terminal.
Allows to select the desired level of verbosity.</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>tmt run -l report        # overall summary only
tmt run -l report -v     # individual test results
tmt run -l report -vv    # show full paths to logs
tmt run -l report -vvv   # provide complete test output
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/report/display.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReportDisplay</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">ReportPlugin</span><span class="p">[</span><span class="n">ReportDisplayData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Show test results on the terminal.</span>

<span class="sd">    Give a concise summary of test results directly on the terminal.</span>
<span class="sd">    Allows to select the desired level of verbosity.</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        tmt run -l report        # overall summary only</span>
<span class="sd">        tmt run -l report -v     # individual test results</span>
<span class="sd">        tmt run -l report -vv    # show full paths to logs</span>
<span class="sd">        tmt run -l report -vvv   # provide complete test output</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ReportDisplayData</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Discover available tests</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
        <span class="c1"># Show individual test results only in verbose mode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;always&#39;</span><span class="p">:</span>
            <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">seen_guests</span> <span class="o">=</span> <span class="p">{</span><span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">()}</span>

            <span class="n">display_guest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_guests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">ResultRenderer</span><span class="p">(</span>
            <span class="n">basepath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">verbosity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span>
            <span class="n">display_guest</span><span class="o">=</span><span class="n">display_guest</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">print_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.display.ReportDisplay.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.report.display.ReportDisplay.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Discover available tests</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/display.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Discover available tests</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="c1"># Show individual test results only in verbose mode</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;always&#39;</span><span class="p">:</span>
        <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;never&#39;</span><span class="p">:</span>
        <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">seen_guests</span> <span class="o">=</span> <span class="p">{</span><span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">()}</span>

        <span class="n">display_guest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_guests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">ResultRenderer</span><span class="p">(</span>
        <span class="n">basepath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verbosity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span>
        <span class="n">display_guest</span><span class="o">=</span><span class="n">display_guest</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">print_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="html">html<a class="headerlink" href="#html" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.report.html.ReportHtml" class="doc doc-heading">
            <code>tmt.steps.report.html.ReportHtml</code>


<a href="#tmt.steps.report.html.ReportHtml" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.report.ReportPlugin">ReportPlugin</span>[<span title="tmt.steps.report.html.ReportHtmlData">ReportHtmlData</span>]</code></p>


        <p>Format test results into an HTML report.</p>
<p>Create a local <code>html</code> file with test results arranged in
a table. Optionally open the page in the default browser.</p>
<p>Example config:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Enable html report from the command line
tmt run --all report --how html
tmt run --all report --how html --open
tmt run -l report -h html -o
</code></pre></div>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Use html as the default report for given plan
report:
    how: html
    open: true
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/report/html.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReportHtml</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">ReportPlugin</span><span class="p">[</span><span class="n">ReportHtmlData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format test results into an HTML report.</span>

<span class="sd">    Create a local ``html`` file with test results arranged in</span>
<span class="sd">    a table. Optionally open the page in the default browser.</span>

<span class="sd">    Example config:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Enable html report from the command line</span>
<span class="sd">        tmt run --all report --how html</span>
<span class="sd">        tmt run --all report --how html --open</span>
<span class="sd">        tmt run -l report -h html -o</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Use html as the default report for given plan</span>
<span class="sd">        report:</span>
<span class="sd">            how: html</span>
<span class="sd">            open: true</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ReportHtmlData</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_preserved_workdir_members</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A set of members of the step workdir that should not be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">DEFAULT_FILENAME</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="c1"># Prepare the template</span>
        <span class="n">environment</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">default_template_environment</span><span class="p">()</span>

        <span class="c1"># Explicitly enable the autoescape because it&#39;s disabled by default by TMT</span>
        <span class="c1"># (see /teemtee/tmt/issues/2873 for more info.</span>
        <span class="n">environment</span><span class="o">.</span><span class="n">autoescape</span> <span class="o">=</span> <span class="n">select_autoescape</span><span class="p">(</span><span class="n">enabled_extensions</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;html.j2&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">absolute_paths</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">_linkable_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>

            <span class="n">environment</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkable_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_linkable_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Links used in html should be relative to a workdir</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">_linkable_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># narrow type</span>

                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">))</span>

            <span class="n">environment</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkable_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_linkable_path</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;always&#39;</span><span class="p">:</span>
            <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">seen_guests</span> <span class="o">=</span> <span class="p">{</span><span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">()}</span>

            <span class="n">display_guest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_guests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>

        <span class="c1"># Write the report</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="n">DEFAULT_FILENAME</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">filepath</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
                <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">render_template_file</span><span class="p">(</span>
                    <span class="n">HTML_TEMPLATE_PATH</span><span class="p">,</span>
                    <span class="n">environment</span><span class="p">,</span>
                    <span class="n">results</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">(),</span>
                    <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                    <span class="n">plan</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="p">,</span>
                    <span class="n">display_guest</span><span class="o">=</span><span class="n">display_guest</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write the output &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>

        <span class="c1"># Nothing more to do in dry mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Show output file path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">open</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Open target in webbrowser</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;Successfully opened in the web browser.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Failed to open the web browser.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to open the web browser: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;Unable to open the web browser.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.html.ReportHtml.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.report.html.ReportHtml.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Process results</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/html.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process results</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Prepare the template</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">default_template_environment</span><span class="p">()</span>

    <span class="c1"># Explicitly enable the autoescape because it&#39;s disabled by default by TMT</span>
    <span class="c1"># (see /teemtee/tmt/issues/2873 for more info.</span>
    <span class="n">environment</span><span class="o">.</span><span class="n">autoescape</span> <span class="o">=</span> <span class="n">select_autoescape</span><span class="p">(</span><span class="n">enabled_extensions</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;html.j2&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">absolute_paths</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_linkable_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkable_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_linkable_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Links used in html should be relative to a workdir</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_linkable_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># narrow type</span>

            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">))</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkable_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_linkable_path</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;always&#39;</span><span class="p">:</span>
        <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">display_guest</span> <span class="o">==</span> <span class="s1">&#39;never&#39;</span><span class="p">:</span>
        <span class="n">display_guest</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">seen_guests</span> <span class="o">=</span> <span class="p">{</span><span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">()}</span>

        <span class="n">display_guest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_guests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="c1"># Write the report</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="n">DEFAULT_FILENAME</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">filepath</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
            <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">render_template_file</span><span class="p">(</span>
                <span class="n">HTML_TEMPLATE_PATH</span><span class="p">,</span>
                <span class="n">environment</span><span class="p">,</span>
                <span class="n">results</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">(),</span>
                <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                <span class="n">plan</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="p">,</span>
                <span class="n">display_guest</span><span class="o">=</span><span class="n">display_guest</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write the output &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>

    <span class="c1"># Nothing more to do in dry mode</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Show output file path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">open</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Open target in webbrowser</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;Successfully opened in the web browser.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Failed to open the web browser.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to open the web browser: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;Unable to open the web browser.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="junit">junit<a class="headerlink" href="#junit" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.report.junit.ReportJUnit" class="doc doc-heading">
            <code>tmt.steps.report.junit.ReportJUnit</code>


<a href="#tmt.steps.report.junit.ReportJUnit" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.report.ReportPlugin">ReportPlugin</span>[<span title="tmt.steps.report.junit.ReportJUnitData">ReportJUnitData</span>]</code></p>


        <p>Save test results in chosen JUnit flavor format.</p>
<p>When flavor is set to custom, the <code>template-path</code> with a path to a custom template must be
provided.</p>
<p>When <code>file</code> is not specified, output is written into a file named <code>junit.xml</code> located in
the current workdir.</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Enable junit report from the command line
tmt run --all report --how junit
tmt run --all report --how junit --file test.xml
</code></pre></div>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Use junit as the default report for given plan
report:
    how: junit
    file: test.xml
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/report/junit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span>
    <span class="s1">&#39;junit&#39;</span><span class="p">,</span>
    <span class="n">installation_hint</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        For neater JUnit XML and XML validation against the XSD, ``lxml`` package is required</span>
<span class="s2">        by the ``report/junit`` plugin.</span>

<span class="s2">        To quickly test ``lxml`` presence, you can try running ``python -c &#39;import lxml&#39;``.</span>

<span class="s2">        * Users who installed tmt from system repositories should install ``tmt+report-junit``</span>
<span class="s2">          package.</span>
<span class="s2">        * Users who installed tmt from PyPI should install ``tmt[report-junit]`` extra.</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReportJUnit</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">ReportPlugin</span><span class="p">[</span><span class="n">ReportJUnitData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save test results in chosen JUnit flavor format.</span>

<span class="sd">    When flavor is set to custom, the ``template-path`` with a path to a custom template must be</span>
<span class="sd">    provided.</span>

<span class="sd">    When ``file`` is not specified, output is written into a file named ``junit.xml`` located in</span>
<span class="sd">    the current workdir.</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Enable junit report from the command line</span>
<span class="sd">        tmt run --all report --how junit</span>
<span class="sd">        tmt run --all report --how junit --file test.xml</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Use junit as the default report for given plan</span>
<span class="sd">        report:</span>
<span class="sd">            how: junit</span>
<span class="sd">            file: test.xml</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ReportJUnitData</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the module options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flavor</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;custom&#39; flavor requires the &#39;--template-path&#39; argument.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flavor</span> <span class="o">!=</span> <span class="s1">&#39;custom&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;--template-path&#39; can be used only with &#39;--flavor=custom&#39;.&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_preserved_workdir_members</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A set of members of the step workdir that should not be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">members</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_preserved_workdir_members</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="n">members</span><span class="p">,</span> <span class="n">DEFAULT_FILENAME</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">members</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read executed tests and write junit</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_options</span><span class="p">()</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">f_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="n">DEFAULT_FILENAME</span>

        <span class="n">xml_data</span> <span class="o">=</span> <span class="n">make_junit_xml</span><span class="p">(</span>
            <span class="n">phase</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">flavor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flavor</span><span class="p">,</span>
            <span class="n">template_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template_path</span><span class="p">,</span>
            <span class="n">include_output_log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">include_output_log</span><span class="p">,</span>
            <span class="n">prettify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">prettify</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write the output &#39;</span><span class="si">{</span><span class="n">f_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.junit.ReportJUnit.check_options" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_options</span><span class="p">()</span></code>

<a href="#tmt.steps.report.junit.ReportJUnit.check_options" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check the module options</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/junit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the module options</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flavor</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template_path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;custom&#39; flavor requires the &#39;--template-path&#39; argument.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flavor</span> <span class="o">!=</span> <span class="s1">&#39;custom&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template_path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;--template-path&#39; can be used only with &#39;--flavor=custom&#39;.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.junit.ReportJUnit.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.report.junit.ReportJUnit.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Read executed tests and write junit</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/junit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read executed tests and write junit</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_options</span><span class="p">()</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">f_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="n">DEFAULT_FILENAME</span>

    <span class="n">xml_data</span> <span class="o">=</span> <span class="n">make_junit_xml</span><span class="p">(</span>
        <span class="n">phase</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">flavor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flavor</span><span class="p">,</span>
        <span class="n">template_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template_path</span><span class="p">,</span>
        <span class="n">include_output_log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">include_output_log</span><span class="p">,</span>
        <span class="n">prettify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">prettify</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write the output &#39;</span><span class="si">{</span><span class="n">f_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="polarion">polarion<a class="headerlink" href="#polarion" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.report.polarion.ReportPolarion" class="doc doc-heading">
            <code>tmt.steps.report.polarion.ReportPolarion</code>


<a href="#tmt.steps.report.polarion.ReportPolarion" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.report.ReportPlugin">ReportPlugin</span>[<span title="tmt.steps.report.polarion.ReportPolarionData">ReportPolarionData</span>]</code></p>


        <p>Write test results into an xUnit file and upload to Polarion.</p>
<p>In order to get quickly started create a pylero config
file <code>~/.pylero</code> in your home directory with the
following content:</p>
<p>.. code-block:: ini</p>
<div class="highlight"><pre><span></span><code>[webservice]
url=https://{your polarion web URL}/polarion
svn_repo=https://{your polarion web URL}/repo
default_project={your project name}
user={your username}
password={your password}
</code></pre></div>
<p>See the <code>Pylero Documentation</code> for more details on how
to configure the <code>pylero</code> module.</p>
<p>https://github.com/RedHatQE/pylero</p>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>For Polarion report to export correctly you need to
use password authentication, since exporting the
report happens through Polarion XUnit importer which
does not support using tokens. You can still
authenticate with token to only generate the report
using ``--no-upload`` argument.
</code></pre></div>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>Your Polarion project might need a custom value format
for the ``arch``, ``planned-in`` and other fields. The
format of these fields might differ across Polarion
projects, for example, ``x8664`` can be used instead
of ``x86_64`` for the architecture.
</code></pre></div>
<p>Examples:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Enable polarion report from the command line
tmt run --all report --how polarion --project-id tmt
tmt run --all report --how polarion --project-id tmt --no-upload --file test.xml
</code></pre></div>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Use polarion as the default report for given plan
report:
    how: polarion
    file: test.xml
    project-id: tmt
    title: tests_that_pass
    planned-in: RHEL-9.1.0
    pool-team: sst_tmt
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/report/polarion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;polarion&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReportPolarion</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">ReportPlugin</span><span class="p">[</span><span class="n">ReportPolarionData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write test results into an xUnit file and upload to Polarion.</span>

<span class="sd">    In order to get quickly started create a pylero config</span>
<span class="sd">    file ``~/.pylero`` in your home directory with the</span>
<span class="sd">    following content:</span>

<span class="sd">    .. code-block:: ini</span>

<span class="sd">        [webservice]</span>
<span class="sd">        url=https://{your polarion web URL}/polarion</span>
<span class="sd">        svn_repo=https://{your polarion web URL}/repo</span>
<span class="sd">        default_project={your project name}</span>
<span class="sd">        user={your username}</span>
<span class="sd">        password={your password}</span>

<span class="sd">    See the ``Pylero Documentation`` for more details on how</span>
<span class="sd">    to configure the ``pylero`` module.</span>

<span class="sd">    https://github.com/RedHatQE/pylero</span>

<span class="sd">    .. note::</span>

<span class="sd">        For Polarion report to export correctly you need to</span>
<span class="sd">        use password authentication, since exporting the</span>
<span class="sd">        report happens through Polarion XUnit importer which</span>
<span class="sd">        does not support using tokens. You can still</span>
<span class="sd">        authenticate with token to only generate the report</span>
<span class="sd">        using ``--no-upload`` argument.</span>

<span class="sd">    .. note::</span>

<span class="sd">        Your Polarion project might need a custom value format</span>
<span class="sd">        for the ``arch``, ``planned-in`` and other fields. The</span>
<span class="sd">        format of these fields might differ across Polarion</span>
<span class="sd">        projects, for example, ``x8664`` can be used instead</span>
<span class="sd">        of ``x86_64`` for the architecture.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Enable polarion report from the command line</span>
<span class="sd">        tmt run --all report --how polarion --project-id tmt</span>
<span class="sd">        tmt run --all report --how polarion --project-id tmt --no-upload --file test.xml</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Use polarion as the default report for given plan</span>
<span class="sd">        report:</span>
<span class="sd">            how: polarion</span>
<span class="sd">            file: test.xml</span>
<span class="sd">            project-id: tmt</span>
<span class="sd">            title: tests_that_pass</span>
<span class="sd">            planned-in: RHEL-9.1.0</span>
<span class="sd">            pool-team: sst_tmt</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ReportPolarionData</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_preserved_workdir_members</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A set of members of the step workdir that should not be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">members</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_preserved_workdir_members</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="n">members</span><span class="p">,</span> <span class="n">DEFAULT_FILENAME</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">members</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Go through executed tests and report into Polarion</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">tmt.export.polarion</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_polarion_case_ids</span><span class="p">,</span> <span class="n">import_polarion</span>

        <span class="n">import_polarion</span><span class="p">()</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">tmt.export.polarion</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolarionWorkItem</span>

        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">title</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_TITLE&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                <span class="o">+</span>
                <span class="c1"># Polarion server running with UTC timezone</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_TEMPLATE&#39;</span><span class="p">)</span>
        <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">project_id</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_PROJECT_ID&#39;</span><span class="p">,</span> <span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">default_project</span>
        <span class="p">)</span>

        <span class="c1"># The project_id is required</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
                <span class="s2">&quot;The Polarion project ID could not be determined. Consider setting it using &quot;</span>
                <span class="s2">&quot;&#39;--project-id&#39; argument or by setting &#39;TMT_PLUGIN_REPORT_POLARION_PROJECT_ID&#39; &quot;</span>
                <span class="s2">&quot;environment variable.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO: try use self.data instead - but these fields are not optional, they do have</span>
        <span class="c1"># default values, do envvars even have any effect at all??</span>
        <span class="n">upload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;upload&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_UPLOAD&#39;</span><span class="p">))</span>
        <span class="n">use_facts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use-facts&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_USE_FACTS&#39;</span><span class="p">))</span>

        <span class="n">other_testrun_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">,</span>
            <span class="s1">&#39;assignee&#39;</span><span class="p">,</span>
            <span class="s1">&#39;build&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compose_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fips&#39;</span><span class="p">,</span>
            <span class="s1">&#39;logs&#39;</span><span class="p">,</span>
            <span class="s1">&#39;planned_in&#39;</span><span class="p">,</span>
            <span class="s1">&#39;platform&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pool_team&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sample_image&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">testsuites_properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">tr_field</span> <span class="ow">in</span> <span class="n">other_testrun_fields</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tr_field</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_</span><span class="si">{</span><span class="n">tr_field</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="c1"># TODO: remove the os.getenv when envvars in click work with steps in plans as well</span>
            <span class="c1"># as with steps on cmdline</span>
            <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">testsuites_properties</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;polarion-custom-</span><span class="si">{</span><span class="n">tr_field</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>

        <span class="k">if</span> <span class="n">use_facts</span><span class="p">:</span>
            <span class="n">guests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ready_guests</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-custom-hostname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">primary_address</span>
                <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-custom-arch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">arch</span>
            <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
                    <span class="s1">&#39;Failed to retrieve facts from the guest environment. &#39;</span>
                    <span class="s1">&#39;You can use a `--no-use-facts` argument to disable &#39;</span>
                    <span class="s1">&#39;this behavior.&#39;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>

        <span class="k">if</span> <span class="n">template</span><span class="p">:</span>
            <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-testrun-template-id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>

        <span class="n">logs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_REPORT_ARTIFACTS_URL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logs</span> <span class="ow">and</span> <span class="s1">&#39;polarion-custom-logs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">testsuites_properties</span><span class="p">:</span>
            <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-custom-logs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logs</span>

        <span class="n">project_span_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">results_context</span> <span class="o">=</span> <span class="n">ResultsContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results_context</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">ids</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Test Case &#39;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not exported to Polarion, &quot;</span>
                    <span class="s2">&quot;please run &#39;tmt tests export --how polarion&#39; on it.&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">work_item_id</span><span class="p">,</span> <span class="n">test_project_id</span> <span class="o">=</span> <span class="n">find_polarion_case_ids</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">work_item_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">test_project_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test case &#39;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; missing or not found in Polarion.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">test_project_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">project_span_ids</span><span class="p">:</span>
                <span class="n">project_span_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_project_id</span><span class="p">)</span>

            <span class="n">testcase_properties</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;polarion-testcase-id&#39;</span><span class="p">:</span> <span class="n">work_item_id</span><span class="p">,</span>
                <span class="s1">&#39;polarion-testcase-project-id&#39;</span><span class="p">:</span> <span class="n">test_project_id</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># ignore[assignment]: mypy does not support different types for property getter and</span>
            <span class="c1"># setter. The assignment is correct, but mypy cannot tell.</span>
            <span class="c1"># See https://github.com/python/mypy/issues/3004 for getter/setter discussions</span>
            <span class="n">result</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">testcase_properties</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">testsuites_properties</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;polarion-project-id&#39;</span><span class="p">:</span> <span class="n">project_id</span><span class="p">,</span>
                <span class="s1">&#39;polarion-user-id&#39;</span><span class="p">:</span> <span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
                <span class="s1">&#39;polarion-testrun-title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s1">&#39;polarion-project-span-ids&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">project_id</span><span class="p">,</span> <span class="o">*</span><span class="n">project_span_ids</span><span class="p">]),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Add deployment mode if provided as a context variable</span>
        <span class="n">deployment_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">_fmf_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deployment-mode&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">deployment_mode</span><span class="p">:</span>
            <span class="n">testsuites_properties</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;polarion-custom-deploymentMode&#39;</span><span class="p">:</span> <span class="n">deployment_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>

        <span class="c1"># ignore[assignment]: mypy does not support different types for property getter</span>
        <span class="c1"># and setter. The assignment is correct, but mypy cannot tell.</span>
        <span class="c1"># See https://github.com/python/mypy/issues/3004 for getter/setter discussions</span>
        <span class="n">results_context</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">testsuites_properties</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="n">xml_data</span> <span class="o">=</span> <span class="n">make_junit_xml</span><span class="p">(</span>
            <span class="n">phase</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">flavor</span><span class="o">=</span><span class="s1">&#39;polarion&#39;</span><span class="p">,</span>
            <span class="n">prettify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">prettify</span><span class="p">,</span>
            <span class="n">include_output_log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">include_output_log</span><span class="p">,</span>
            <span class="n">results_context</span><span class="o">=</span><span class="n">results_context</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">f_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="n">DEFAULT_FILENAME</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">f_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write the output &#39;</span><span class="si">{</span><span class="n">f_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>

        <span class="k">if</span> <span class="n">upload</span><span class="p">:</span>
            <span class="n">server_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="n">polarion_import_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">server_url</span><span class="si">}{</span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">server_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="si">}</span><span class="s1">import/xunit&#39;</span>
            <span class="p">)</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
                <span class="n">polarion_import_url</span><span class="p">,</span>
                <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;xunit.xml&#39;</span><span class="p">,</span> <span class="n">xml_data</span><span class="p">),</span>
                <span class="p">},</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Response code is </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s1"> with text: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Polarion upload can be done manually using command:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;curl -k -u &lt;USER&gt;:&lt;PASSWORD&gt; -X POST -F file=@&lt;XUNIT_XML_FILE_PATH&gt; &#39;</span>
                <span class="s1">&#39;&lt;POLARION_URL&gt;/polarion/import/xunit&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;xUnit file saved at&#39;</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.polarion.ReportPolarion.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.report.polarion.ReportPolarion.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Go through executed tests and report into Polarion</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/polarion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Go through executed tests and report into Polarion</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">tmt.export.polarion</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_polarion_case_ids</span><span class="p">,</span> <span class="n">import_polarion</span>

    <span class="n">import_polarion</span><span class="p">()</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">tmt.export.polarion</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolarionWorkItem</span>

    <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">title</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_TITLE&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
            <span class="o">+</span>
            <span class="c1"># Polarion server running with UTC timezone</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">template</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_TEMPLATE&#39;</span><span class="p">)</span>
    <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">project_id</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
        <span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_PROJECT_ID&#39;</span><span class="p">,</span> <span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">default_project</span>
    <span class="p">)</span>

    <span class="c1"># The project_id is required</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">project_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
            <span class="s2">&quot;The Polarion project ID could not be determined. Consider setting it using &quot;</span>
            <span class="s2">&quot;&#39;--project-id&#39; argument or by setting &#39;TMT_PLUGIN_REPORT_POLARION_PROJECT_ID&#39; &quot;</span>
            <span class="s2">&quot;environment variable.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># TODO: try use self.data instead - but these fields are not optional, they do have</span>
    <span class="c1"># default values, do envvars even have any effect at all??</span>
    <span class="n">upload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;upload&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_UPLOAD&#39;</span><span class="p">))</span>
    <span class="n">use_facts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use-facts&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_USE_FACTS&#39;</span><span class="p">))</span>

    <span class="n">other_testrun_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;arch&#39;</span><span class="p">,</span>
        <span class="s1">&#39;assignee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;build&#39;</span><span class="p">,</span>
        <span class="s1">&#39;compose_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;description&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fips&#39;</span><span class="p">,</span>
        <span class="s1">&#39;logs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;planned_in&#39;</span><span class="p">,</span>
        <span class="s1">&#39;platform&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pool_team&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sample_image&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">testsuites_properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">tr_field</span> <span class="ow">in</span> <span class="n">other_testrun_fields</span><span class="p">:</span>
        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tr_field</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TMT_PLUGIN_REPORT_POLARION_</span><span class="si">{</span><span class="n">tr_field</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="c1"># TODO: remove the os.getenv when envvars in click work with steps in plans as well</span>
        <span class="c1"># as with steps on cmdline</span>
        <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">testsuites_properties</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;polarion-custom-</span><span class="si">{</span><span class="n">tr_field</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>

    <span class="k">if</span> <span class="n">use_facts</span><span class="p">:</span>
        <span class="n">guests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ready_guests</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-custom-hostname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">primary_address</span>
            <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-custom-arch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">arch</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
                <span class="s1">&#39;Failed to retrieve facts from the guest environment. &#39;</span>
                <span class="s1">&#39;You can use a `--no-use-facts` argument to disable &#39;</span>
                <span class="s1">&#39;this behavior.&#39;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>

    <span class="k">if</span> <span class="n">template</span><span class="p">:</span>
        <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-testrun-template-id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>

    <span class="n">logs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TMT_REPORT_ARTIFACTS_URL&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">logs</span> <span class="ow">and</span> <span class="s1">&#39;polarion-custom-logs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">testsuites_properties</span><span class="p">:</span>
        <span class="n">testsuites_properties</span><span class="p">[</span><span class="s1">&#39;polarion-custom-logs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logs</span>

    <span class="n">project_span_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">results_context</span> <span class="o">=</span> <span class="n">ResultsContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results_context</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">ids</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Test Case &#39;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not exported to Polarion, &quot;</span>
                <span class="s2">&quot;please run &#39;tmt tests export --how polarion&#39; on it.&quot;</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">work_item_id</span><span class="p">,</span> <span class="n">test_project_id</span> <span class="o">=</span> <span class="n">find_polarion_case_ids</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">work_item_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">test_project_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test case &#39;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; missing or not found in Polarion.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">test_project_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">project_span_ids</span><span class="p">:</span>
            <span class="n">project_span_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_project_id</span><span class="p">)</span>

        <span class="n">testcase_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;polarion-testcase-id&#39;</span><span class="p">:</span> <span class="n">work_item_id</span><span class="p">,</span>
            <span class="s1">&#39;polarion-testcase-project-id&#39;</span><span class="p">:</span> <span class="n">test_project_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># ignore[assignment]: mypy does not support different types for property getter and</span>
        <span class="c1"># setter. The assignment is correct, but mypy cannot tell.</span>
        <span class="c1"># See https://github.com/python/mypy/issues/3004 for getter/setter discussions</span>
        <span class="n">result</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">testcase_properties</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">testsuites_properties</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s1">&#39;polarion-project-id&#39;</span><span class="p">:</span> <span class="n">project_id</span><span class="p">,</span>
            <span class="s1">&#39;polarion-user-id&#39;</span><span class="p">:</span> <span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;polarion-testrun-title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
            <span class="s1">&#39;polarion-project-span-ids&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">project_id</span><span class="p">,</span> <span class="o">*</span><span class="n">project_span_ids</span><span class="p">]),</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Add deployment mode if provided as a context variable</span>
    <span class="n">deployment_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">_fmf_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deployment-mode&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="n">deployment_mode</span><span class="p">:</span>
        <span class="n">testsuites_properties</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;polarion-custom-deploymentMode&#39;</span><span class="p">:</span> <span class="n">deployment_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>

    <span class="c1"># ignore[assignment]: mypy does not support different types for property getter</span>
    <span class="c1"># and setter. The assignment is correct, but mypy cannot tell.</span>
    <span class="c1"># See https://github.com/python/mypy/issues/3004 for getter/setter discussions</span>
    <span class="n">results_context</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">testsuites_properties</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="n">xml_data</span> <span class="o">=</span> <span class="n">make_junit_xml</span><span class="p">(</span>
        <span class="n">phase</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">flavor</span><span class="o">=</span><span class="s1">&#39;polarion&#39;</span><span class="p">,</span>
        <span class="n">prettify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">prettify</span><span class="p">,</span>
        <span class="n">include_output_log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">include_output_log</span><span class="p">,</span>
        <span class="n">results_context</span><span class="o">=</span><span class="n">results_context</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">f_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="n">DEFAULT_FILENAME</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">f_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">xml_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write the output &#39;</span><span class="si">{</span><span class="n">f_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>

    <span class="k">if</span> <span class="n">upload</span><span class="p">:</span>
        <span class="n">server_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">polarion_import_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">server_url</span><span class="si">}{</span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">server_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="si">}</span><span class="s1">import/xunit&#39;</span>
        <span class="p">)</span>
        <span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">PolarionWorkItem</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
            <span class="n">polarion_import_url</span><span class="p">,</span>
            <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;xunit.xml&#39;</span><span class="p">,</span> <span class="n">xml_data</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Response code is </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s1"> with text: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Polarion upload can be done manually using command:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;curl -k -u &lt;USER&gt;:&lt;PASSWORD&gt; -X POST -F file=@&lt;XUNIT_XML_FILE_PATH&gt; &#39;</span>
            <span class="s1">&#39;&lt;POLARION_URL&gt;/polarion/import/xunit&#39;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;xUnit file saved at&#39;</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="reportportal">reportportal<a class="headerlink" href="#reportportal" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.report.reportportal.ReportReportPortal" class="doc doc-heading">
            <code>tmt.steps.report.reportportal.ReportReportPortal</code>


<a href="#tmt.steps.report.reportportal.ReportReportPortal" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.report.ReportPlugin">ReportPlugin</span>[<span title="tmt.steps.report.reportportal.ReportReportPortalData">ReportReportPortalData</span>]</code></p>


        <p>Report test results and their subresults to a ReportPortal instance via API.</p>
<p>For communication with Report Portal API is necessary to provide
following options:</p>
<ul>
<li>token for authentication</li>
<li>url of the ReportPortal instance</li>
<li>project name</li>
</ul>
<p>In addition to command line options it's possible to use environment
variables:</p>
<p>.. code-block:: bash</p>
<div class="highlight"><pre><span></span><code>export TMT_PLUGIN_REPORT_REPORTPORTAL_${MY_OPTION}=${MY_VALUE}

# Boolean options are activated with value of 1:
TMT_PLUGIN_REPORT_REPORTPORTAL_SUITE_PER_PLAN=1
</code></pre></div>
<p>Assuming the URL and token are provided by the environment variables,
the plan config can look like this:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Use ReportPortal as the default report for given plan
report:
    how: reportportal
    project: baseosqe

# Report context attributes for given plan
context:
    ...

environment:
    ...
</code></pre></div>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Report description, contact, id and environment variables for given test
summary: ...
contact: ...
id: ...
environment:
    ...
</code></pre></div>
<p>Where the context and environment sections must be filled with
corresponding data in order to report context as attributes
(arch, component, distro, trigger, compose, etc.) and
environment variables as parameters in the Item Details.</p>
<p>Other reported fmf data are summary, id, web link and contact per
test.</p>
<p>Two types of data structures are supported for reporting to ReportPortal:</p>
<ul>
<li><code>launch-per-plan</code> mapping (default) that results in launch-test structure.</li>
<li><code>suite-per-plan</code> mapping that results in launch-suite-test structure.</li>
</ul>
<p>Supported report use cases:</p>
<ul>
<li>Report a new run in launch-suite-test or launch-test structure</li>
<li>Report an additional rerun with <code>launch-rerun</code> option and same launch name (-&gt; Retry items)
  or by reusing the run and reporting with <code>again</code> option (-&gt; append logs)</li>
<li>To see plan progress, discover and report an empty (IDLE) run
  and reuse the run for execution and updating the report with <code>again</code> option</li>
<li>Report contents of a new run to an existing launch via the URL ID in three ways:
  tests to launch, suites to launch and tests to suite.</li>
</ul>
<p>Example:</p>
<p>.. code-block:: shell</p>
<div class="highlight"><pre><span></span><code># Enable ReportPortal report from the command line depending on the use case:

## Simple upload with all project, url endpoint and user token passed in command line
tmt run --all report --how reportportal --project=baseosqe --url=&quot;https://reportportal.xxx.com&quot; --token=&quot;abc...789&quot;

## Simple upload with url and token exported in environment variable
tmt run --all report --how reportportal --project=baseosqe

## Upload with project name in fmf data, filtering out parameters (environment variables)
## that tend to be unique and break the history aggregation
tmt run --all report --how reportportal --exclude-variables=&quot;^(TMT|PACKIT|TESTING_FARM).*&quot;

## Upload all plans as suites into one ReportPortal launch
tmt run --all report --how reportportal --suite-per-plan --launch=Errata --launch-description=&quot;...&quot;

## Rerun the launch with suite structure for the test results to be uploaded
## into the latest launch with the same name as a new &#39;Retry&#39; tab
## (mapping based on unique paths)
tmt run --all report --how reportportal --suite-per-plan --launch=Errata --launch-rerun

## Rerun the tmt run and append the new result logs under the previous one
## uploaded in ReportPortal (precise mapping)
tmt run --id run-012 --all report --how reportportal --again

## Additional upload of new suites into given launch with suite structure
tmt run --all report --how reportportal --suite-per-plan --upload-to-launch=4321

## Additional upload of new tests into given launch with non-suite structure
tmt run --all report --how reportportal --launch-per-plan --upload-to-launch=1234

## Additional upload of new tests into given suite
tmt run --all report --how reportportal --upload-to-suite=123456

## Upload Idle tests, then execute it and add result logs into prepared empty tests
tmt run discover report --how reportportal --defect-type=Idle
tmt run --last --all report --how reportportal --again
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s2">&quot;reportportal&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ReportReportPortal</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">ReportPlugin</span><span class="p">[</span><span class="n">ReportReportPortalData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Report test results and their subresults to a ReportPortal instance via API.</span>

<span class="sd">    For communication with Report Portal API is necessary to provide</span>
<span class="sd">    following options:</span>

<span class="sd">    * token for authentication</span>
<span class="sd">    * url of the ReportPortal instance</span>
<span class="sd">    * project name</span>

<span class="sd">    In addition to command line options it&#39;s possible to use environment</span>
<span class="sd">    variables:</span>

<span class="sd">    .. code-block:: bash</span>

<span class="sd">        export TMT_PLUGIN_REPORT_REPORTPORTAL_${MY_OPTION}=${MY_VALUE}</span>

<span class="sd">        # Boolean options are activated with value of 1:</span>
<span class="sd">        TMT_PLUGIN_REPORT_REPORTPORTAL_SUITE_PER_PLAN=1</span>

<span class="sd">    Assuming the URL and token are provided by the environment variables,</span>
<span class="sd">    the plan config can look like this:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Use ReportPortal as the default report for given plan</span>
<span class="sd">        report:</span>
<span class="sd">            how: reportportal</span>
<span class="sd">            project: baseosqe</span>

<span class="sd">        # Report context attributes for given plan</span>
<span class="sd">        context:</span>
<span class="sd">            ...</span>

<span class="sd">        environment:</span>
<span class="sd">            ...</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Report description, contact, id and environment variables for given test</span>
<span class="sd">        summary: ...</span>
<span class="sd">        contact: ...</span>
<span class="sd">        id: ...</span>
<span class="sd">        environment:</span>
<span class="sd">            ...</span>

<span class="sd">    Where the context and environment sections must be filled with</span>
<span class="sd">    corresponding data in order to report context as attributes</span>
<span class="sd">    (arch, component, distro, trigger, compose, etc.) and</span>
<span class="sd">    environment variables as parameters in the Item Details.</span>

<span class="sd">    Other reported fmf data are summary, id, web link and contact per</span>
<span class="sd">    test.</span>

<span class="sd">    Two types of data structures are supported for reporting to ReportPortal:</span>

<span class="sd">    * ``launch-per-plan`` mapping (default) that results in launch-test structure.</span>
<span class="sd">    * ``suite-per-plan`` mapping that results in launch-suite-test structure.</span>

<span class="sd">    Supported report use cases:</span>

<span class="sd">    * Report a new run in launch-suite-test or launch-test structure</span>
<span class="sd">    * Report an additional rerun with ``launch-rerun`` option and same launch name (-&gt; Retry items)</span>
<span class="sd">      or by reusing the run and reporting with ``again`` option (-&gt; append logs)</span>
<span class="sd">    * To see plan progress, discover and report an empty (IDLE) run</span>
<span class="sd">      and reuse the run for execution and updating the report with ``again`` option</span>
<span class="sd">    * Report contents of a new run to an existing launch via the URL ID in three ways:</span>
<span class="sd">      tests to launch, suites to launch and tests to suite.</span>

<span class="sd">    Example:</span>

<span class="sd">    .. code-block:: shell</span>

<span class="sd">        # Enable ReportPortal report from the command line depending on the use case:</span>

<span class="sd">        ## Simple upload with all project, url endpoint and user token passed in command line</span>
<span class="sd">        tmt run --all report --how reportportal --project=baseosqe --url=&quot;https://reportportal.xxx.com&quot; --token=&quot;abc...789&quot;</span>

<span class="sd">        ## Simple upload with url and token exported in environment variable</span>
<span class="sd">        tmt run --all report --how reportportal --project=baseosqe</span>

<span class="sd">        ## Upload with project name in fmf data, filtering out parameters (environment variables)</span>
<span class="sd">        ## that tend to be unique and break the history aggregation</span>
<span class="sd">        tmt run --all report --how reportportal --exclude-variables=&quot;^(TMT|PACKIT|TESTING_FARM).*&quot;</span>

<span class="sd">        ## Upload all plans as suites into one ReportPortal launch</span>
<span class="sd">        tmt run --all report --how reportportal --suite-per-plan --launch=Errata --launch-description=&quot;...&quot;</span>

<span class="sd">        ## Rerun the launch with suite structure for the test results to be uploaded</span>
<span class="sd">        ## into the latest launch with the same name as a new &#39;Retry&#39; tab</span>
<span class="sd">        ## (mapping based on unique paths)</span>
<span class="sd">        tmt run --all report --how reportportal --suite-per-plan --launch=Errata --launch-rerun</span>

<span class="sd">        ## Rerun the tmt run and append the new result logs under the previous one</span>
<span class="sd">        ## uploaded in ReportPortal (precise mapping)</span>
<span class="sd">        tmt run --id run-012 --all report --how reportportal --again</span>

<span class="sd">        ## Additional upload of new suites into given launch with suite structure</span>
<span class="sd">        tmt run --all report --how reportportal --suite-per-plan --upload-to-launch=4321</span>

<span class="sd">        ## Additional upload of new tests into given launch with non-suite structure</span>
<span class="sd">        tmt run --all report --how reportportal --launch-per-plan --upload-to-launch=1234</span>

<span class="sd">        ## Additional upload of new tests into given suite</span>
<span class="sd">        tmt run --all report --how reportportal --upload-to-suite=123456</span>

<span class="sd">        ## Upload Idle tests, then execute it and add result logs into prepared empty tests</span>
<span class="sd">        tmt run discover report --how reportportal --defect-type=Idle</span>
<span class="sd">        tmt run --last --all report --how reportportal --again</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ReportReportPortalData</span>

    <span class="n">TMT_TO_RP_RESULT_STATUS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">PASS</span><span class="p">:</span> <span class="s2">&quot;PASSED&quot;</span><span class="p">,</span>
        <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">,</span>
        <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span> <span class="s2">&quot;SKIPPED&quot;</span><span class="p">,</span>
        <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">WARN</span><span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">,</span>
        <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">,</span>
        <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">SKIP</span><span class="p">:</span> <span class="s2">&quot;SKIPPED&quot;</span><span class="p">,</span>
        <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">PENDING</span><span class="p">:</span> <span class="s2">&quot;SKIPPED&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the endpoint response and raise an exception if needed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Response code from the endpoint&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Message from the endpoint&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Received non-ok status code </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;from ReportPortal: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check options for known troublesome combinations</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_per_plan</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The options &#39;--launch-per-plan&#39; and &#39;--suite-per-plan&#39; are mutually exclusive. &quot;</span>
                <span class="s2">&quot;Default option &#39;--launch-per-plan&#39; is used.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_rerun</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_launch</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_suite</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected option combination: &quot;</span>
                <span class="s2">&quot;&#39;--launch-rerun&#39; is ignored when uploading additional tests.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_rerun</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected option combination: &#39;--launch-rerun&#39; &quot;</span>
                <span class="s2">&quot;may cause an unexpected behaviour with launch-per-plan structure&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Use the same format of timestramp as tmt does</span>
        <span class="k">return</span> <span class="n">format_timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;*/*&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">api_version</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">construct_launch_attributes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">suite_per_plan</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">suite_per_plan</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Get common attributes across the plans</span>
        <span class="n">merged_plans</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">plan</span><span class="o">.</span><span class="n">_fmf_context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">plan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">plans</span>
        <span class="p">]</span>
        <span class="n">result_dict</span> <span class="o">=</span> <span class="n">merged_plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">current_plan</span> <span class="ow">in</span> <span class="n">merged_plans</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">tmp_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">current_plan</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result_dict</span> <span class="ow">and</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span>
            <span class="p">}</span>
            <span class="n">result_dict</span> <span class="o">=</span> <span class="n">tmp_dict</span>
        <span class="k">return</span> <span class="p">[{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_defect_type_locator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">defect_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defect_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ti001&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;settings&quot;</span><span class="p">)</span>
        <span class="n">defect_types</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subTypes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defect_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ti001&quot;</span>

        <span class="n">groups_to_search</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;TO_INVESTIGATE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NO_DEFECT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SYSTEM_ISSUE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AUTOMATION_BUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PRODUCT_BUG&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">groups_to_search</span><span class="p">:</span>
            <span class="n">defect_types_list</span> <span class="o">=</span> <span class="n">defect_types</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
            <span class="n">dt_tmp</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">dt</span><span class="p">[</span><span class="s1">&#39;locator&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">defect_types_list</span>
                <span class="k">if</span> <span class="n">dt</span><span class="p">[</span><span class="s1">&#39;longName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">defect_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="n">dt_locator</span> <span class="o">=</span> <span class="n">dt_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">dt_tmp</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">dt_locator</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dt_locator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Defect type &#39;</span><span class="si">{</span><span class="n">defect_type</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="s2">&quot;is not be defined in the project </span><span class="si">{self.data.project}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;defect_type&quot;</span><span class="p">,</span> <span class="n">defect_type</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt_locator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rp_api_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rp_api_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="p">:</span> <span class="n">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rp_api_put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="p">:</span> <span class="n">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curr_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend text with the launch description (if provided)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">curr_description</span><span class="p">:</span>
                <span class="n">curr_description</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">curr_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span>
        <span class="k">return</span> <span class="n">curr_description</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append_link_template</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">link_template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">tmt</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Result</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend text with rendered link template</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span>
            <span class="n">link_template</span><span class="p">,</span>
            <span class="n">PLAN_NAME</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">pathless_safe_name</span><span class="p">,</span>
            <span class="n">RESULT</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&lt;br&gt;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">description</span> <span class="k">else</span> <span class="n">url</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">upload_result_logs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Result</span><span class="p">,</span> <span class="n">tmt</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">SubResult</span><span class="p">],</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span>
        <span class="n">item_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">launch_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">write_out_failures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload all result log files into the ReportPortal instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">upload_log</span><span class="p">(</span><span class="n">log_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">is_yaml</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_traceback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_yaml</span><span class="p">:</span>
                    <span class="n">logs</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">yaml_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">log_path</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">log_path</span><span class="p">)]</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">FileError</span><span class="p">,</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">GeneralError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">show_exception_as_warning</span><span class="p">(</span>
                    <span class="n">exception</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to read log file &#39;</span><span class="si">{</span><span class="n">log_path</span><span class="si">}</span><span class="s2">&#39; for ReportPortal upload.&quot;</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span>

            <span class="n">filter_settings</span> <span class="o">=</span> <span class="n">LogFilterSettings</span><span class="p">(</span>
                <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">traceback_size_limit</span> <span class="k">if</span> <span class="n">is_traceback</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">log_size_limit</span><span class="p">,</span>
                <span class="n">is_traceback</span><span class="o">=</span><span class="n">is_traceback</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
                <span class="c1"># Add file name to the log if it is not a traceback</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_traceback</span><span class="p">:</span>
                    <span class="n">log</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;### `</span><span class="si">{</span><span class="n">log_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">`</span><span class="se">\n</span><span class="si">{</span><span class="n">log</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="c1"># Upload log</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;log/entry&quot;</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">_filter_log</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">filter_settings</span><span class="p">),</span>
                        <span class="s2">&quot;itemUuid&quot;</span><span class="p">:</span> <span class="n">item_uuid</span><span class="p">,</span>
                        <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                        <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span> <span class="k">if</span> <span class="n">is_traceback</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>

        <span class="c1"># Upload result logs</span>
        <span class="k">for</span> <span class="n">log_path</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">log_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_log_pattern</span><span class="p">):</span>
                <span class="n">upload_log</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>

        <span class="c1"># Upload check result logs if the check failed</span>
        <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">check</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check</span><span class="o">.</span><span class="n">result</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ResultOutcome</span><span class="o">.</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">ERROR</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">log_path</span> <span class="ow">in</span> <span class="n">check</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">log_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_log_pattern</span><span class="p">):</span>
                    <span class="n">upload_log</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="n">is_traceback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Upload failure logs</span>
        <span class="k">if</span> <span class="n">write_out_failures</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">failure_log</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">failure_logs</span><span class="p">:</span>
                <span class="n">upload_log</span><span class="p">(</span><span class="n">failure_log</span><span class="p">,</span> <span class="n">is_yaml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_traceback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute_rp_import</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the import of test, results and subresults into ReportPortal</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1"># Use the current datetime as a default, but this is the worst case scenario</span>
        <span class="c1"># and we should use timestamps from results log as much as possible.</span>
        <span class="n">launch_start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span>

        <span class="c1"># Support for idle tests</span>
        <span class="n">executed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">executed</span><span class="p">:</span>
            <span class="c1"># Launch time should be the earliest start time of all plans.</span>
            <span class="c1">#</span>
            <span class="c1"># The datetime *strings* are in fact sorted here, but finding the minimum will work,</span>
            <span class="c1"># because the datetime in ISO format is designed to be lexicographically sortable.</span>
            <span class="n">launch_start_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="n">r</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="c1"># Create launch, suites (if &quot;--suite_per_plan&quot;) and tests;</span>
        <span class="c1"># or report to existing launch/suite if its id is given</span>
        <span class="n">suite_per_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span>
        <span class="n">launch_per_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_per_plan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">launch_per_plan</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">suite_per_plan</span><span class="p">:</span>
            <span class="n">launch_per_plan</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># by default</span>

        <span class="n">suite_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_suite</span>
        <span class="n">launch_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_launch</span>

        <span class="n">suite_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_uuid</span>
        <span class="n">launch_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_uuid</span>
        <span class="n">additional_upload</span> <span class="o">=</span> <span class="n">suite_id</span> <span class="ow">or</span> <span class="n">launch_id</span> <span class="ow">or</span> <span class="n">launch_uuid</span>
        <span class="n">is_the_first_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">launch_uuid</span> <span class="ow">and</span> <span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_the_first_plan</span><span class="p">:</span>
            <span class="n">rp_phases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">phases</span><span class="p">(</span><span class="n">ReportReportPortal</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">rp_phases</span><span class="p">:</span>
                <span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">rp_phases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_uuid</span>

        <span class="n">create_test</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">test_uuids</span>
        <span class="n">create_suite</span> <span class="o">=</span> <span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">suite_uuid</span> <span class="ow">or</span> <span class="n">suite_id</span><span class="p">)</span>
        <span class="n">create_launch</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">launch_uuid</span> <span class="ow">or</span> <span class="n">launch_id</span> <span class="ow">or</span> <span class="n">suite_uuid</span> <span class="ow">or</span> <span class="n">suite_id</span><span class="p">)</span>

        <span class="n">launch_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">name</span>
        <span class="n">suite_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">launch_url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">launch_rerun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_rerun</span>
        <span class="n">envar_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">exclude_variables</span> <span class="ow">or</span> <span class="s2">&quot;$^&quot;</span>
        <span class="n">defect_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">defect_type</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">_fmf_context</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">launch_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_launch_attributes</span><span class="p">(</span><span class="n">suite_per_plan</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">suite_per_plan</span><span class="p">:</span>
            <span class="n">launch_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">suite_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">summary</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">launch_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">summary</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">launch_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">launch_description</span><span class="p">)</span>
            <span class="n">suite_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Check whether artifacts URL has been provided</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">artifacts_url</span><span class="p">:</span>
            <span class="n">launch_description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;br&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">artifacts_url</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">suite_description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;br&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">artifacts_url</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Communication with RP instance</span>
        <span class="k">with</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">retry_session</span><span class="p">(</span>
            <span class="n">status_forcelist</span><span class="o">=</span><span class="p">(</span>
                <span class="mi">429</span><span class="p">,</span>  <span class="c1"># Too Many Requests</span>
                <span class="mi">500</span><span class="p">,</span>  <span class="c1"># Internal Server Error</span>
                <span class="mi">502</span><span class="p">,</span>  <span class="c1"># Bad Gateway</span>
                <span class="mi">503</span><span class="p">,</span>  <span class="c1"># Service Unavailable</span>
                <span class="mi">504</span><span class="p">,</span>  <span class="c1"># Gateway Timeout</span>
            <span class="p">)</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ssl_verify</span>

            <span class="k">if</span> <span class="n">create_launch</span><span class="p">:</span>
                <span class="c1"># Create a launch</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;launch&quot;</span><span class="p">,</span> <span class="n">launch_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">launch_name</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">launch_description</span><span class="p">,</span>
                        <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">launch_attributes</span><span class="p">,</span>
                        <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">launch_start_time</span><span class="p">,</span>
                        <span class="s2">&quot;rerun&quot;</span><span class="p">:</span> <span class="n">launch_rerun</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Get the launch_uuid or info to log</span>
                <span class="k">if</span> <span class="n">suite_id</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">suite_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">suite_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">)</span>
                    <span class="n">suite_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
                    <span class="n">launch_id</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;launchId&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">launch_id</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;launch/</span><span class="si">{</span><span class="n">launch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">launch_uuid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">launch_id</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;launch/uuid/</span><span class="si">{</span><span class="n">launch_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">launch_id</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

            <span class="c1"># Print the launch info</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">create_launch</span><span class="p">:</span>
                <span class="n">launch_name</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;launch&quot;</span><span class="p">,</span> <span class="n">launch_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">launch_id</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">launch_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">launch_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">launch_uuid</span>

            <span class="n">launch_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">/ui/#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">/launches/all/</span><span class="si">{</span><span class="n">launch_id</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">create_suite</span><span class="p">:</span>
                <span class="c1"># Create a suite</span>
                <span class="n">suite_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;suite&quot;</span><span class="p">,</span> <span class="n">suite_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">suite_name</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">suite_description</span><span class="p">,</span>
                        <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span>
                        <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">launch_start_time</span><span class="p">,</span>
                        <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;suite&quot;</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="n">suite_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">suite_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="n">suite_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;suite&quot;</span><span class="p">,</span> <span class="n">suite_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">suite_id</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">suite_uuid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">suite_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_uuid</span> <span class="o">=</span> <span class="n">suite_uuid</span>

            <span class="c1"># The first test starts with the launch (at the worst case)</span>
            <span class="n">test_start_time</span> <span class="o">=</span> <span class="n">launch_start_time</span>

            <span class="k">for</span> <span class="n">result</span><span class="p">,</span> <span class="n">test_origin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results_for_tests</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">discover</span><span class="o">.</span><span class="n">tests</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">test</span> <span class="o">=</span> <span class="n">test_origin</span><span class="o">.</span><span class="n">test</span> <span class="k">if</span> <span class="n">test_origin</span> <span class="k">else</span> <span class="kc">None</span>

                <span class="n">test_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">test_description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">test_link</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">test_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">env_vars</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">item_attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">serial_number</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">serial_number</span>
                    <span class="n">test_name</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span>

                    <span class="c1"># Use the actual timestamp or reuse the old one if missing</span>
                    <span class="n">test_start_time</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">or</span> <span class="n">test_start_time</span>

                    <span class="c1"># for guests, save their primary address</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">primary_address</span><span class="p">:</span>
                        <span class="n">item_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;guest_primary_address&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">primary_address</span><span class="p">}</span>
                        <span class="p">)</span>
                    <span class="c1"># for multi-host tests store also provision name and role</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;default-0&#39;</span><span class="p">:</span>
                        <span class="n">item_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;guest_name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">role</span><span class="p">:</span>
                        <span class="n">item_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;guest_role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">role</span><span class="p">})</span>

                <span class="c1"># update RP item with additional attributes if test details are available</span>
                <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
                    <span class="n">serial_number</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">serial_number</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_name</span><span class="p">:</span>
                        <span class="n">test_name</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">author</span><span class="p">:</span>
                        <span class="n">item_attributes</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">author</span><span class="p">}</span> <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">author</span>
                        <span class="p">]</span>
                    <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">contact</span><span class="p">:</span>
                        <span class="n">item_attributes</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;contact&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">contact</span><span class="p">}</span> <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">contact</span>
                        <span class="p">]</span>
                    <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">summary</span><span class="p">:</span>
                        <span class="n">test_description</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">summary</span>
                    <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">web_link</span><span class="p">():</span>
                        <span class="n">test_link</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">web_link</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                        <span class="n">test_id</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">id</span>

                    <span class="n">env_vars</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">envar_pattern</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                    <span class="p">]</span>

                <span class="k">if</span> <span class="n">create_test</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_launch</span> <span class="ow">and</span> <span class="n">launch_per_plan</span>
                    <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_suite</span><span class="p">:</span>
                        <span class="n">test_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">test_description</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">link_template</span><span class="p">:</span>
                        <span class="n">test_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_link_template</span><span class="p">(</span>
                            <span class="n">test_description</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">link_template</span><span class="p">,</span>
                            <span class="n">result</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="c1"># Create a test item</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                        <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;/</span><span class="si">{</span><span class="n">suite_uuid</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">suite_uuid</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">test_description</span><span class="p">,</span>
                            <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">item_attributes</span><span class="p">,</span>
                            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">env_vars</span><span class="p">,</span>
                            <span class="s2">&quot;codeRef&quot;</span><span class="p">:</span> <span class="n">test_link</span><span class="p">,</span>
                            <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;testCaseId&quot;</span><span class="p">:</span> <span class="n">test_id</span><span class="p">,</span>
                            <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">test_start_time</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">)</span>

                    <span class="n">item_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">item_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">item_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">test_uuids</span><span class="p">[</span><span class="n">serial_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_uuid</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">item_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">test_uuids</span><span class="p">[</span><span class="n">serial_number</span><span class="p">]</span>

                <span class="c1"># If the result end-time is not defined, use the latest result start-time as</span>
                <span class="c1"># default.</span>
                <span class="n">test_end_time</span> <span class="o">=</span> <span class="n">test_start_time</span>

                <span class="c1"># Support for idle tests</span>
                <span class="n">item_status</span> <span class="o">=</span> <span class="s2">&quot;SKIPPED&quot;</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="c1"># Shift the timestamp to the end of a test.</span>
                    <span class="n">test_end_time</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">or</span> <span class="n">test_end_time</span>

                    <span class="n">item_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TMT_TO_RP_RESULT_STATUS</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">upload_result_logs</span><span class="p">(</span>
                        <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                        <span class="n">item_uuid</span><span class="o">=</span><span class="n">item_uuid</span><span class="p">,</span>
                        <span class="n">launch_uuid</span><span class="o">=</span><span class="n">launch_uuid</span><span class="p">,</span>
                        <span class="n">timestamp</span><span class="o">=</span><span class="n">test_end_time</span><span class="p">,</span>
                        <span class="n">write_out_failures</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">item_status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">),</span>
                    <span class="p">)</span>

                    <span class="c1"># If upload of subresults is required, create (and *finish*) the child test</span>
                    <span class="c1"># item for every tmt subresult and map it under the parent test item.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_subresults</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">subresult</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">subresult</span><span class="p">:</span>
                            <span class="c1"># Create a child item</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sub-test&quot;</span><span class="p">,</span> <span class="n">subresult</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                            <span class="c1"># Use the parent test start-time as a default</span>
                            <span class="n">subresult_start_time</span> <span class="o">=</span> <span class="n">subresult</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">or</span> <span class="n">test_start_time</span>

                            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">item_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">subresult</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                    <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">subresult_start_time</span><span class="p">,</span>
                                <span class="p">},</span>
                            <span class="p">)</span>

                            <span class="n">child_item_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                            <span class="k">assert</span> <span class="n">child_item_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

                            <span class="n">child_item_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TMT_TO_RP_RESULT_STATUS</span><span class="p">[</span><span class="n">subresult</span><span class="o">.</span><span class="n">result</span><span class="p">]</span>
                            <span class="n">subtest_end_time</span> <span class="o">=</span> <span class="n">subresult</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">or</span> <span class="n">test_end_time</span>

                            <span class="c1"># Upload the subtest (child) logs</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">upload_result_logs</span><span class="p">(</span>
                                <span class="n">result</span><span class="o">=</span><span class="n">subresult</span><span class="p">,</span>
                                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                                <span class="n">item_uuid</span><span class="o">=</span><span class="n">child_item_uuid</span><span class="p">,</span>
                                <span class="n">launch_uuid</span><span class="o">=</span><span class="n">launch_uuid</span><span class="p">,</span>
                                <span class="n">timestamp</span><span class="o">=</span><span class="n">subtest_end_time</span><span class="p">,</span>
                                <span class="n">write_out_failures</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">child_item_status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">),</span>
                            <span class="p">)</span>

                            <span class="c1"># Finish the child item</span>
                            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">child_item_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">child_item_status</span><span class="p">,</span>
                                    <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">subtest_end_time</span><span class="p">,</span>
                                <span class="p">},</span>
                            <span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">child_item_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Finish the parent test item</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">item_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                        <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">test_end_time</span><span class="p">,</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">item_status</span><span class="p">,</span>
                        <span class="s2">&quot;issue&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;issueType&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_defect_type_locator</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">defect_type</span><span class="p">)},</span>
                    <span class="p">},</span>
                <span class="p">)</span>

                <span class="c1"># The launch ends with the last test</span>
                <span class="n">launch_end_time</span> <span class="o">=</span> <span class="n">test_end_time</span>

            <span class="k">if</span> <span class="n">create_suite</span><span class="p">:</span>
                <span class="c1"># Finish the test suite</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;/</span><span class="si">{</span><span class="n">suite_uuid</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">suite_uuid</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span> <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">launch_end_time</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="n">is_the_last_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">is_the_last_plan</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">defect_type</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">launch_per_plan</span> <span class="ow">or</span> <span class="p">(</span><span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="n">is_the_last_plan</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">additional_upload</span><span class="p">:</span>
                <span class="c1"># Finish the launch</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;launch/</span><span class="si">{</span><span class="n">launch_uuid</span><span class="si">}</span><span class="s2">/finish&quot;</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">launch_end_time</span><span class="p">},</span>
                <span class="p">)</span>
                <span class="n">launch_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;link&quot;</span><span class="p">))</span>

            <span class="k">assert</span> <span class="n">launch_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">launch_url</span><span class="p">,</span> <span class="s2">&quot;magenta&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_url</span> <span class="o">=</span> <span class="n">launch_url</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Report test results to the endpoint</span>

<span class="sd">        Create a ReportPortal launch and its test items,</span>
<span class="sd">        fill it with all parts needed and report the logs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No ReportPortal endpoint url provided.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">project</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No ReportPortal project provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No ReportPortal token provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No run data available.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_options</span><span class="p">()</span>

        <span class="c1"># If SSL verification is disabled, do not print warnings with urllib3</span>
        <span class="n">warning_filter_action</span><span class="p">:</span> <span class="n">ActionType</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ssl_verify</span><span class="p">:</span>
            <span class="n">warning_filter_action</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;SSL verification is disabled for all requests being made to ReportPortal &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;instance (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="n">catch_warnings_safe</span><span class="p">(</span>
            <span class="n">action</span><span class="o">=</span><span class="n">warning_filter_action</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InsecureRequestWarning</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_rp_import</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.reportportal.ReportReportPortal.append_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">append_description</span><span class="p">(</span><span class="n">curr_description</span><span class="p">)</span></code>

<a href="#tmt.steps.report.reportportal.ReportReportPortal.append_description" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extend text with the launch description (if provided)</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">append_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curr_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extend text with the launch description (if provided)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">curr_description</span><span class="p">:</span>
            <span class="n">curr_description</span> <span class="o">+=</span> <span class="s2">&quot;&lt;br&gt;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curr_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span>
    <span class="k">return</span> <span class="n">curr_description</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.reportportal.ReportReportPortal.append_link_template" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">append_link_template</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">link_template</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></code>

<a href="#tmt.steps.report.reportportal.ReportReportPortal.append_link_template" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extend text with rendered link template</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">append_link_template</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">link_template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">tmt</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Result</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extend text with rendered link template</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span>
        <span class="n">link_template</span><span class="p">,</span>
        <span class="n">PLAN_NAME</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">pathless_safe_name</span><span class="p">,</span>
        <span class="n">RESULT</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&lt;br&gt;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">description</span> <span class="k">else</span> <span class="n">url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.reportportal.ReportReportPortal.check_options" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_options</span><span class="p">()</span></code>

<a href="#tmt.steps.report.reportportal.ReportReportPortal.check_options" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check options for known troublesome combinations</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check options for known troublesome combinations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_per_plan</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The options &#39;--launch-per-plan&#39; and &#39;--suite-per-plan&#39; are mutually exclusive. &quot;</span>
            <span class="s2">&quot;Default option &#39;--launch-per-plan&#39; is used.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_rerun</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_launch</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_suite</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Unexpected option combination: &quot;</span>
            <span class="s2">&quot;&#39;--launch-rerun&#39; is ignored when uploading additional tests.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_rerun</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Unexpected option combination: &#39;--launch-rerun&#39; &quot;</span>
            <span class="s2">&quot;may cause an unexpected behaviour with launch-per-plan structure&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.reportportal.ReportReportPortal.execute_rp_import" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute_rp_import</span><span class="p">()</span></code>

<a href="#tmt.steps.report.reportportal.ReportReportPortal.execute_rp_import" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Execute the import of test, results and subresults into ReportPortal</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">execute_rp_import</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the import of test, results and subresults into ReportPortal</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="c1"># Use the current datetime as a default, but this is the worst case scenario</span>
    <span class="c1"># and we should use timestamps from results log as much as possible.</span>
    <span class="n">launch_start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span>

    <span class="c1"># Support for idle tests</span>
    <span class="n">executed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">executed</span><span class="p">:</span>
        <span class="c1"># Launch time should be the earliest start time of all plans.</span>
        <span class="c1">#</span>
        <span class="c1"># The datetime *strings* are in fact sorted here, but finding the minimum will work,</span>
        <span class="c1"># because the datetime in ISO format is designed to be lexicographically sortable.</span>
        <span class="n">launch_start_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">r</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="c1"># Create launch, suites (if &quot;--suite_per_plan&quot;) and tests;</span>
    <span class="c1"># or report to existing launch/suite if its id is given</span>
    <span class="n">suite_per_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_per_plan</span>
    <span class="n">launch_per_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_per_plan</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">launch_per_plan</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">suite_per_plan</span><span class="p">:</span>
        <span class="n">launch_per_plan</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># by default</span>

    <span class="n">suite_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_suite</span>
    <span class="n">launch_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_launch</span>

    <span class="n">suite_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_uuid</span>
    <span class="n">launch_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_uuid</span>
    <span class="n">additional_upload</span> <span class="o">=</span> <span class="n">suite_id</span> <span class="ow">or</span> <span class="n">launch_id</span> <span class="ow">or</span> <span class="n">launch_uuid</span>
    <span class="n">is_the_first_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">launch_uuid</span> <span class="ow">and</span> <span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_the_first_plan</span><span class="p">:</span>
        <span class="n">rp_phases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">phases</span><span class="p">(</span><span class="n">ReportReportPortal</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rp_phases</span><span class="p">:</span>
            <span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">rp_phases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_uuid</span>

    <span class="n">create_test</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">test_uuids</span>
    <span class="n">create_suite</span> <span class="o">=</span> <span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">suite_uuid</span> <span class="ow">or</span> <span class="n">suite_id</span><span class="p">)</span>
    <span class="n">create_launch</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">launch_uuid</span> <span class="ow">or</span> <span class="n">launch_id</span> <span class="ow">or</span> <span class="n">suite_uuid</span> <span class="ow">or</span> <span class="n">suite_id</span><span class="p">)</span>

    <span class="n">launch_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">name</span>
    <span class="n">suite_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">launch_url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">launch_rerun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_rerun</span>
    <span class="n">envar_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">exclude_variables</span> <span class="ow">or</span> <span class="s2">&quot;$^&quot;</span>
    <span class="n">defect_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">defect_type</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">_fmf_context</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="n">launch_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_launch_attributes</span><span class="p">(</span><span class="n">suite_per_plan</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">suite_per_plan</span><span class="p">:</span>
        <span class="n">launch_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_description</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">suite_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">summary</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">launch_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">summary</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">launch_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">launch_description</span><span class="p">)</span>
        <span class="n">suite_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Check whether artifacts URL has been provided</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">artifacts_url</span><span class="p">:</span>
        <span class="n">launch_description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;br&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">artifacts_url</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">suite_description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;br&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">artifacts_url</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Communication with RP instance</span>
    <span class="k">with</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">retry_session</span><span class="p">(</span>
        <span class="n">status_forcelist</span><span class="o">=</span><span class="p">(</span>
            <span class="mi">429</span><span class="p">,</span>  <span class="c1"># Too Many Requests</span>
            <span class="mi">500</span><span class="p">,</span>  <span class="c1"># Internal Server Error</span>
            <span class="mi">502</span><span class="p">,</span>  <span class="c1"># Bad Gateway</span>
            <span class="mi">503</span><span class="p">,</span>  <span class="c1"># Service Unavailable</span>
            <span class="mi">504</span><span class="p">,</span>  <span class="c1"># Gateway Timeout</span>
        <span class="p">)</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ssl_verify</span>

        <span class="k">if</span> <span class="n">create_launch</span><span class="p">:</span>
            <span class="c1"># Create a launch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;launch&quot;</span><span class="p">,</span> <span class="n">launch_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">launch_name</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">launch_description</span><span class="p">,</span>
                    <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">launch_attributes</span><span class="p">,</span>
                    <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">launch_start_time</span><span class="p">,</span>
                    <span class="s2">&quot;rerun&quot;</span><span class="p">:</span> <span class="n">launch_rerun</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get the launch_uuid or info to log</span>
            <span class="k">if</span> <span class="n">suite_id</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">suite_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">suite_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">)</span>
                <span class="n">suite_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
                <span class="n">launch_id</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;launchId&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">launch_id</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;launch/</span><span class="si">{</span><span class="n">launch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">launch_uuid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">launch_id</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;launch/uuid/</span><span class="si">{</span><span class="n">launch_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">launch_id</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="c1"># Print the launch info</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">create_launch</span><span class="p">:</span>
            <span class="n">launch_name</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;launch&quot;</span><span class="p">,</span> <span class="n">launch_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">launch_id</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">launch_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">launch_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_uuid</span> <span class="o">=</span> <span class="n">launch_uuid</span>

        <span class="n">launch_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">/ui/#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">/launches/all/</span><span class="si">{</span><span class="n">launch_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">create_suite</span><span class="p">:</span>
            <span class="c1"># Create a suite</span>
            <span class="n">suite_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;suite&quot;</span><span class="p">,</span> <span class="n">suite_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">suite_name</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">suite_description</span><span class="p">,</span>
                    <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span>
                    <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">launch_start_time</span><span class="p">,</span>
                    <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;suite&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">suite_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">suite_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">suite_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;suite&quot;</span><span class="p">,</span> <span class="n">suite_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">suite_id</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">suite_uuid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">suite_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">suite_uuid</span> <span class="o">=</span> <span class="n">suite_uuid</span>

        <span class="c1"># The first test starts with the launch (at the worst case)</span>
        <span class="n">test_start_time</span> <span class="o">=</span> <span class="n">launch_start_time</span>

        <span class="k">for</span> <span class="n">result</span><span class="p">,</span> <span class="n">test_origin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">results_for_tests</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">discover</span><span class="o">.</span><span class="n">tests</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">test_origin</span><span class="o">.</span><span class="n">test</span> <span class="k">if</span> <span class="n">test_origin</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="n">test_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">test_description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">test_link</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">test_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">env_vars</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">item_attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">serial_number</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">serial_number</span>
                <span class="n">test_name</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># Use the actual timestamp or reuse the old one if missing</span>
                <span class="n">test_start_time</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">or</span> <span class="n">test_start_time</span>

                <span class="c1"># for guests, save their primary address</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">primary_address</span><span class="p">:</span>
                    <span class="n">item_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;guest_primary_address&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">primary_address</span><span class="p">}</span>
                    <span class="p">)</span>
                <span class="c1"># for multi-host tests store also provision name and role</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;default-0&#39;</span><span class="p">:</span>
                    <span class="n">item_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;guest_name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">role</span><span class="p">:</span>
                    <span class="n">item_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;guest_role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">guest</span><span class="o">.</span><span class="n">role</span><span class="p">})</span>

            <span class="c1"># update RP item with additional attributes if test details are available</span>
            <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
                <span class="n">serial_number</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">serial_number</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">test_name</span><span class="p">:</span>
                    <span class="n">test_name</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">author</span><span class="p">:</span>
                    <span class="n">item_attributes</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">author</span><span class="p">}</span> <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">author</span>
                    <span class="p">]</span>
                <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">contact</span><span class="p">:</span>
                    <span class="n">item_attributes</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;contact&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">contact</span><span class="p">}</span> <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">contact</span>
                    <span class="p">]</span>
                <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">summary</span><span class="p">:</span>
                    <span class="n">test_description</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">summary</span>
                <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">web_link</span><span class="p">():</span>
                    <span class="n">test_link</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">web_link</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">test_id</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">id</span>

                <span class="n">env_vars</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">envar_pattern</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="p">]</span>

            <span class="k">if</span> <span class="n">create_test</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_launch</span> <span class="ow">and</span> <span class="n">launch_per_plan</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_to_suite</span><span class="p">:</span>
                    <span class="n">test_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">test_description</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">link_template</span><span class="p">:</span>
                    <span class="n">test_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">append_link_template</span><span class="p">(</span>
                        <span class="n">test_description</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">link_template</span><span class="p">,</span>
                        <span class="n">result</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># Create a test item</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;/</span><span class="si">{</span><span class="n">suite_uuid</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">suite_uuid</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">,</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">test_description</span><span class="p">,</span>
                        <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">item_attributes</span><span class="p">,</span>
                        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">env_vars</span><span class="p">,</span>
                        <span class="s2">&quot;codeRef&quot;</span><span class="p">:</span> <span class="n">test_link</span><span class="p">,</span>
                        <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;testCaseId&quot;</span><span class="p">:</span> <span class="n">test_id</span><span class="p">,</span>
                        <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">test_start_time</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>

                <span class="n">item_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">item_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">item_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">test_uuids</span><span class="p">[</span><span class="n">serial_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_uuid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">test_uuids</span><span class="p">[</span><span class="n">serial_number</span><span class="p">]</span>

            <span class="c1"># If the result end-time is not defined, use the latest result start-time as</span>
            <span class="c1"># default.</span>
            <span class="n">test_end_time</span> <span class="o">=</span> <span class="n">test_start_time</span>

            <span class="c1"># Support for idle tests</span>
            <span class="n">item_status</span> <span class="o">=</span> <span class="s2">&quot;SKIPPED&quot;</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># Shift the timestamp to the end of a test.</span>
                <span class="n">test_end_time</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">or</span> <span class="n">test_end_time</span>

                <span class="n">item_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TMT_TO_RP_RESULT_STATUS</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">upload_result_logs</span><span class="p">(</span>
                    <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">item_uuid</span><span class="o">=</span><span class="n">item_uuid</span><span class="p">,</span>
                    <span class="n">launch_uuid</span><span class="o">=</span><span class="n">launch_uuid</span><span class="p">,</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="n">test_end_time</span><span class="p">,</span>
                    <span class="n">write_out_failures</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">item_status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">),</span>
                <span class="p">)</span>

                <span class="c1"># If upload of subresults is required, create (and *finish*) the child test</span>
                <span class="c1"># item for every tmt subresult and map it under the parent test item.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_subresults</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">subresult</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">subresult</span><span class="p">:</span>
                        <span class="c1"># Create a child item</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sub-test&quot;</span><span class="p">,</span> <span class="n">subresult</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                        <span class="c1"># Use the parent test start-time as a default</span>
                        <span class="n">subresult_start_time</span> <span class="o">=</span> <span class="n">subresult</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">or</span> <span class="n">test_start_time</span>

                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                            <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">item_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">subresult</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="n">subresult_start_time</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>

                        <span class="n">child_item_uuid</span> <span class="o">=</span> <span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="n">child_item_uuid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

                        <span class="n">child_item_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TMT_TO_RP_RESULT_STATUS</span><span class="p">[</span><span class="n">subresult</span><span class="o">.</span><span class="n">result</span><span class="p">]</span>
                        <span class="n">subtest_end_time</span> <span class="o">=</span> <span class="n">subresult</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">or</span> <span class="n">test_end_time</span>

                        <span class="c1"># Upload the subtest (child) logs</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">upload_result_logs</span><span class="p">(</span>
                            <span class="n">result</span><span class="o">=</span><span class="n">subresult</span><span class="p">,</span>
                            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                            <span class="n">item_uuid</span><span class="o">=</span><span class="n">child_item_uuid</span><span class="p">,</span>
                            <span class="n">launch_uuid</span><span class="o">=</span><span class="n">launch_uuid</span><span class="p">,</span>
                            <span class="n">timestamp</span><span class="o">=</span><span class="n">subtest_end_time</span><span class="p">,</span>
                            <span class="n">write_out_failures</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">child_item_status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">),</span>
                        <span class="p">)</span>

                        <span class="c1"># Finish the child item</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                            <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">child_item_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">child_item_status</span><span class="p">,</span>
                                <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">subtest_end_time</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">child_item_uuid</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Finish the parent test item</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item/</span><span class="si">{</span><span class="n">item_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">test_end_time</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">item_status</span><span class="p">,</span>
                    <span class="s2">&quot;issue&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;issueType&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_defect_type_locator</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">defect_type</span><span class="p">)},</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="c1"># The launch ends with the last test</span>
            <span class="n">launch_end_time</span> <span class="o">=</span> <span class="n">test_end_time</span>

        <span class="k">if</span> <span class="n">create_suite</span><span class="p">:</span>
            <span class="c1"># Finish the test suite</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;item</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;/</span><span class="si">{</span><span class="n">suite_uuid</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">suite_uuid</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span> <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">launch_end_time</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="n">is_the_last_plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">is_the_last_plan</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">defect_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">launch_per_plan</span> <span class="ow">or</span> <span class="p">(</span><span class="n">suite_per_plan</span> <span class="ow">and</span> <span class="n">is_the_last_plan</span><span class="p">)</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">additional_upload</span><span class="p">:</span>
            <span class="c1"># Finish the launch</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_put</span><span class="p">(</span>
                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;launch/</span><span class="si">{</span><span class="n">launch_uuid</span><span class="si">}</span><span class="s2">/finish&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="n">launch_end_time</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">launch_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">yaml_to_dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;link&quot;</span><span class="p">))</span>

        <span class="k">assert</span> <span class="n">launch_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">launch_url</span><span class="p">,</span> <span class="s2">&quot;magenta&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">launch_url</span> <span class="o">=</span> <span class="n">launch_url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.reportportal.ReportReportPortal.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.report.reportportal.ReportReportPortal.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Report test results to the endpoint</p>
<p>Create a ReportPortal launch and its test items,
fill it with all parts needed and report the logs.</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Report test results to the endpoint</span>

<span class="sd">    Create a ReportPortal launch and its test items,</span>
<span class="sd">    fill it with all parts needed and report the logs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No ReportPortal endpoint url provided.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">project</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No ReportPortal project provided.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No ReportPortal token provided.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span><span class="s2">&quot;No run data available.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_options</span><span class="p">()</span>

    <span class="c1"># If SSL verification is disabled, do not print warnings with urllib3</span>
    <span class="n">warning_filter_action</span><span class="p">:</span> <span class="n">ActionType</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ssl_verify</span><span class="p">:</span>
        <span class="n">warning_filter_action</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;SSL verification is disabled for all requests being made to ReportPortal &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;instance (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">).&quot;</span>
        <span class="p">)</span>

    <span class="k">with</span> <span class="n">catch_warnings_safe</span><span class="p">(</span>
        <span class="n">action</span><span class="o">=</span><span class="n">warning_filter_action</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">urllib3</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InsecureRequestWarning</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_rp_import</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.reportportal.ReportReportPortal.handle_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">handle_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></code>

<a href="#tmt.steps.report.reportportal.ReportReportPortal.handle_response" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check the endpoint response and raise an exception if needed</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the endpoint response and raise an exception if needed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Response code from the endpoint&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Message from the endpoint&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ReportError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Received non-ok status code </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;from ReportPortal: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.report.reportportal.ReportReportPortal.upload_result_logs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload_result_logs</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">item_uuid</span><span class="p">,</span> <span class="n">launch_uuid</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">write_out_failures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#tmt.steps.report.reportportal.ReportReportPortal.upload_result_logs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Upload all result log files into the ReportPortal instance</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/report/reportportal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload_result_logs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Result</span><span class="p">,</span> <span class="n">tmt</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">SubResult</span><span class="p">],</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span>
    <span class="n">item_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">launch_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">write_out_failures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload all result log files into the ReportPortal instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">upload_log</span><span class="p">(</span><span class="n">log_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">is_yaml</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">is_traceback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_yaml</span><span class="p">:</span>
                <span class="n">logs</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">yaml_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">log_path</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">execute</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">log_path</span><span class="p">)]</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">FileError</span><span class="p">,</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">GeneralError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">show_exception_as_warning</span><span class="p">(</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to read log file &#39;</span><span class="si">{</span><span class="n">log_path</span><span class="si">}</span><span class="s2">&#39; for ReportPortal upload.&quot;</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">filter_settings</span> <span class="o">=</span> <span class="n">LogFilterSettings</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">traceback_size_limit</span> <span class="k">if</span> <span class="n">is_traceback</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">log_size_limit</span><span class="p">,</span>
            <span class="n">is_traceback</span><span class="o">=</span><span class="n">is_traceback</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
            <span class="c1"># Add file name to the log if it is not a traceback</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_traceback</span><span class="p">:</span>
                <span class="n">log</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;### `</span><span class="si">{</span><span class="n">log_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">`</span><span class="se">\n</span><span class="si">{</span><span class="n">log</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="c1"># Upload log</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rp_api_post</span><span class="p">(</span>
                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;log/entry&quot;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">_filter_log</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">filter_settings</span><span class="p">),</span>
                    <span class="s2">&quot;itemUuid&quot;</span><span class="p">:</span> <span class="n">item_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;launchUuid&quot;</span><span class="p">:</span> <span class="n">launch_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span> <span class="k">if</span> <span class="n">is_traceback</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

    <span class="c1"># Upload result logs</span>
    <span class="k">for</span> <span class="n">log_path</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">log_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_log_pattern</span><span class="p">):</span>
            <span class="n">upload_log</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>

    <span class="c1"># Upload check result logs if the check failed</span>
    <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">check</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">check</span><span class="o">.</span><span class="n">result</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ResultOutcome</span><span class="o">.</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">ResultOutcome</span><span class="o">.</span><span class="n">ERROR</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">log_path</span> <span class="ow">in</span> <span class="n">check</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">log_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upload_log_pattern</span><span class="p">):</span>
                <span class="n">upload_log</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="n">is_traceback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Upload failure logs</span>
    <span class="k">if</span> <span class="n">write_out_failures</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">failure_log</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">failure_logs</span><span class="p">:</span>
            <span class="n">upload_log</span><span class="p">(</span><span class="n">failure_log</span><span class="p">,</span> <span class="n">is_yaml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_traceback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>













              </article>
            </div>


<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>




      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>


      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>


  </body>
</html>