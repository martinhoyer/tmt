
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">




        <link rel="prev" href="../discover/">


        <link rel="next" href="../prepare/">


      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">



        <title>Provision - tmt</title>



      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">












        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">

    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>






  </head>


    <body dir="ltr">


    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#provision" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>






<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="tmt" class="md-header__button md-logo" aria-label="tmt" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">

      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tmt
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Provision

          </span>
        </div>
      </div>
    </div>


      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>





        <label class="md-header__button md-icon" for="__search">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>



      <div class="md-header__source">
        <a href="https://github.com/teemtee/tmt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>

  </nav>

</header>

    <div class="md-container" data-md-component="container">






      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="tmt" class="md-nav__button md-logo" aria-label="tmt" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    tmt
  </label>

    <div class="md-nav__source">
      <a href="https://github.com/teemtee/tmt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>

  <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">



  <span class="md-ellipsis">
    Home

  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">



  <span class="md-ellipsis">
    Overview

  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../guide/" class="md-nav__link">



  <span class="md-ellipsis">
    Guide

  </span>


      </a>
    </li>
















    <li class="md-nav__item md-nav__item--active md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>


          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">



  <span class="md-ellipsis">
    Plugins

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../" class="md-nav__link">



  <span class="md-ellipsis">
    Overview

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../discover/" class="md-nav__link">



  <span class="md-ellipsis">
    Discover

  </span>


      </a>
    </li>












    <li class="md-nav__item md-nav__item--active">

      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">





        <label class="md-nav__link md-nav__link--active" for="__toc">



  <span class="md-ellipsis">
    Provision

  </span>


          <span class="md-nav__icon md-icon"></span>
        </label>

      <a href="./" class="md-nav__link md-nav__link--active">



  <span class="md-ellipsis">
    Provision

  </span>


      </a>



<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#artemis" class="md-nav__link">
    <span class="md-ellipsis">
      artemis
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.artemis.ProvisionArtemis" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionArtemis
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionArtemis">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.artemis.ProvisionArtemis.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#beaker" class="md-nav__link">
    <span class="md-ellipsis">
      beaker
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.mrack.ProvisionBeaker" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionBeaker
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionBeaker">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.mrack.ProvisionBeaker.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.mrack.ProvisionBeaker.wake" class="md-nav__link">
    <span class="md-ellipsis">
      wake
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#bootc" class="md-nav__link">
    <span class="md-ellipsis">
      bootc
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.bootc.ProvisionBootc" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionBootc
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionBootc">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.bootc.ProvisionBootc.is_in_standalone_mode" class="md-nav__link">
    <span class="md-ellipsis">
      is_in_standalone_mode
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.bootc.ProvisionBootc.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.connect.ProvisionConnect" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionConnect
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionConnect">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.connect.ProvisionConnect.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#container" class="md-nav__link">
    <span class="md-ellipsis">
      container
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.podman.ProvisionPodman" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionPodman
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionPodman">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.podman.ProvisionPodman.default" class="md-nav__link">
    <span class="md-ellipsis">
      default
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.podman.ProvisionPodman.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    <span class="md-ellipsis">
      local
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.local.ProvisionLocal" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionLocal
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionLocal">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.local.ProvisionLocal.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#virtualtestcloud" class="md-nav__link">
    <span class="md-ellipsis">
      virtual.testcloud
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.testcloud.ProvisionTestcloud" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionTestcloud
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionTestcloud">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.testcloud.ProvisionTestcloud.clean_images" class="md-nav__link">
    <span class="md-ellipsis">
      clean_images
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.testcloud.ProvisionTestcloud.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>

    </li>










    <li class="md-nav__item">
      <a href="../prepare/" class="md-nav__link">



  <span class="md-ellipsis">
    Prepare

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../execute/" class="md-nav__link">



  <span class="md-ellipsis">
    Execute

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../report/" class="md-nav__link">



  <span class="md-ellipsis">
    Report

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../finish/" class="md-nav__link">



  <span class="md-ellipsis">
    Finish

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#artemis" class="md-nav__link">
    <span class="md-ellipsis">
      artemis
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.artemis.ProvisionArtemis" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionArtemis
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionArtemis">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.artemis.ProvisionArtemis.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#beaker" class="md-nav__link">
    <span class="md-ellipsis">
      beaker
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.mrack.ProvisionBeaker" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionBeaker
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionBeaker">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.mrack.ProvisionBeaker.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.mrack.ProvisionBeaker.wake" class="md-nav__link">
    <span class="md-ellipsis">
      wake
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#bootc" class="md-nav__link">
    <span class="md-ellipsis">
      bootc
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.bootc.ProvisionBootc" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionBootc
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionBootc">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.bootc.ProvisionBootc.is_in_standalone_mode" class="md-nav__link">
    <span class="md-ellipsis">
      is_in_standalone_mode
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.bootc.ProvisionBootc.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.connect.ProvisionConnect" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionConnect
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionConnect">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.connect.ProvisionConnect.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#container" class="md-nav__link">
    <span class="md-ellipsis">
      container
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.podman.ProvisionPodman" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionPodman
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionPodman">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.podman.ProvisionPodman.default" class="md-nav__link">
    <span class="md-ellipsis">
      default
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.podman.ProvisionPodman.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    <span class="md-ellipsis">
      local
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.local.ProvisionLocal" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionLocal
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionLocal">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.local.ProvisionLocal.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#virtualtestcloud" class="md-nav__link">
    <span class="md-ellipsis">
      virtual.testcloud
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#tmt.steps.provision.testcloud.ProvisionTestcloud" class="md-nav__link">
    <span class="md-ellipsis">
      ProvisionTestcloud
    </span>
  </a>

    <nav class="md-nav" aria-label="ProvisionTestcloud">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.testcloud.ProvisionTestcloud.clean_images" class="md-nav__link">
    <span class="md-ellipsis">
      clean_images
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tmt.steps.provision.testcloud.ProvisionTestcloud.go" class="md-nav__link">
    <span class="md-ellipsis">
      go
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">








<h1 id="provision">Provision<a class="headerlink" href="#provision" title="Permanent link">&para;</a></h1>
<p>Provision an environment for testing.</p>
<h2 id="artemis">artemis<a class="headerlink" href="#artemis" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.provision.artemis.ProvisionArtemis" class="doc doc-heading">
            <code>tmt.steps.provision.artemis.ProvisionArtemis</code>


<a href="#tmt.steps.provision.artemis.ProvisionArtemis" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.provision.ProvisionPlugin">ProvisionPlugin</span>[<span title="tmt.steps.provision.artemis.ProvisionArtemisData">ProvisionArtemisData</span>]</code></p>


        <p>Provision guest using Artemis backend.</p>
<p>Reserve a machine using the Artemis service.
Users can specify many requirements, mostly regarding the
desired OS, RAM, disk size and more. Most of the HW specifications
defined in the :ref:<code>/spec/hardware</code> are supported. Including the
:ref:<code>/spec/plans/provision/kickstart</code>.</p>
<p>Artemis takes machines from AWS, OpenStack, Beaker or Azure.
By default, Artemis handles the selection of a cloud provider
to its best abilities and the required specification. However, it
is possible to specify the keyword <code>pool</code> and select the
desired cloud provider.</p>
<p>Artemis project:
https://gitlab.com/testing-farm/artemis</p>
<p>Minimal configuration could look like this:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: artemis
    image: Fedora
    api-url: https://your-artemis.com/
</code></pre></div>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>When used together with the :ref:`testing-farm` infrastructure
some of the options from the first example below will be filled
for you by the Testing Farm service.
</code></pre></div>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>The actual value of ``image`` depends on what images - or &quot;composes&quot; as
Artemis calls them - supports and can deliver.
</code></pre></div>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>The ``api-url`` can be also given via ``TMT_PLUGIN_PROVISION_ARTEMIS_API_URL``
environment variable.
</code></pre></div>
<p>Full configuration example:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: artemis

    # Artemis API
    api-url: https://your-artemis.com/
    api-version: 0.0.32

    # Mandatory environment properties
    image: Fedora

    # Optional environment properties
    arch: aarch64
    pool: optional-pool-name

    # Provisioning process control (optional)
    priority-group: custom-priority-group
    keyname: custom-SSH-key-name

    # Labels to be attached to guest request (optional)
    user-data:
        foo: bar

    # Timeouts and deadlines (optional)
    provision-timeout: 3600
    provision-tick: 10
    api-timeout: 600
    api-retries: 5
    api-retry-backoff-factor: 1
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/provision/artemis.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;artemis&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProvisionArtemis</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ProvisionPlugin</span><span class="p">[</span><span class="n">ProvisionArtemisData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision guest using Artemis backend.</span>

<span class="sd">    Reserve a machine using the Artemis service.</span>
<span class="sd">    Users can specify many requirements, mostly regarding the</span>
<span class="sd">    desired OS, RAM, disk size and more. Most of the HW specifications</span>
<span class="sd">    defined in the :ref:`/spec/hardware` are supported. Including the</span>
<span class="sd">    :ref:`/spec/plans/provision/kickstart`.</span>

<span class="sd">    Artemis takes machines from AWS, OpenStack, Beaker or Azure.</span>
<span class="sd">    By default, Artemis handles the selection of a cloud provider</span>
<span class="sd">    to its best abilities and the required specification. However, it</span>
<span class="sd">    is possible to specify the keyword ``pool`` and select the</span>
<span class="sd">    desired cloud provider.</span>

<span class="sd">    Artemis project:</span>
<span class="sd">    https://gitlab.com/testing-farm/artemis</span>

<span class="sd">    Minimal configuration could look like this:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: artemis</span>
<span class="sd">            image: Fedora</span>
<span class="sd">            api-url: https://your-artemis.com/</span>

<span class="sd">    .. note::</span>

<span class="sd">        When used together with the :ref:`testing-farm` infrastructure</span>
<span class="sd">        some of the options from the first example below will be filled</span>
<span class="sd">        for you by the Testing Farm service.</span>

<span class="sd">    .. note::</span>

<span class="sd">        The actual value of ``image`` depends on what images - or &quot;composes&quot; as</span>
<span class="sd">        Artemis calls them - supports and can deliver.</span>

<span class="sd">    .. note::</span>

<span class="sd">        The ``api-url`` can be also given via ``TMT_PLUGIN_PROVISION_ARTEMIS_API_URL``</span>
<span class="sd">        environment variable.</span>

<span class="sd">    Full configuration example:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: artemis</span>

<span class="sd">            # Artemis API</span>
<span class="sd">            api-url: https://your-artemis.com/</span>
<span class="sd">            api-version: 0.0.32</span>

<span class="sd">            # Mandatory environment properties</span>
<span class="sd">            image: Fedora</span>

<span class="sd">            # Optional environment properties</span>
<span class="sd">            arch: aarch64</span>
<span class="sd">            pool: optional-pool-name</span>

<span class="sd">            # Provisioning process control (optional)</span>
<span class="sd">            priority-group: custom-priority-group</span>
<span class="sd">            keyname: custom-SSH-key-name</span>

<span class="sd">            # Labels to be attached to guest request (optional)</span>
<span class="sd">            user-data:</span>
<span class="sd">                foo: bar</span>

<span class="sd">            # Timeouts and deadlines (optional)</span>
<span class="sd">            provision-timeout: 3600</span>
<span class="sd">            provision-tick: 10</span>
<span class="sd">            api-timeout: 600</span>
<span class="sd">            api-retries: 5</span>
<span class="sd">            api-retry-backoff-factor: 1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ProvisionArtemisData</span>
    <span class="n">_guest_class</span> <span class="o">=</span> <span class="n">GuestArtemis</span>

    <span class="n">_thread_safe</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Guest instance</span>
    <span class="n">_guest</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provision the guest</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">api_version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPORTED_API_VERSIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ArtemisProvisionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API version &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">api_version</span><span class="si">}</span><span class="s2">&#39; not supported.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">ArtemisGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestArtemis</span><span class="p">(</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.artemis.ProvisionArtemis.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.artemis.ProvisionArtemis.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Provision the guest</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/artemis.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision the guest</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">api_version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPORTED_API_VERSIONS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ArtemisProvisionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API version &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">api_version</span><span class="si">}</span><span class="s2">&#39; not supported.&quot;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ArtemisGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestArtemis</span><span class="p">(</span>
        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="beaker">beaker<a class="headerlink" href="#beaker" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.provision.mrack.ProvisionBeaker" class="doc doc-heading">
            <code>tmt.steps.provision.mrack.ProvisionBeaker</code>


<a href="#tmt.steps.provision.mrack.ProvisionBeaker" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.provision.ProvisionPlugin">ProvisionPlugin</span>[<span title="tmt.steps.provision.mrack.ProvisionBeakerData">ProvisionBeakerData</span>]</code></p>


        <p>Provision guest on Beaker system using mrack.</p>
<p>Reserve a machine from the Beaker pool using the <code>mrack</code>
plugin. <code>mrack</code> is a multicloud provisioning library
supporting multiple cloud services including Beaker.</p>
<p>The following two files are used for configuration:</p>
<p><code>/etc/tmt/mrack.conf</code> for basic configuration</p>
<p><code>/etc/tmt/provisioning-config.yaml</code> configuration per supported provider</p>
<p>Beaker installs distribution specified by the <code>image</code>
key. If the image can not be translated using the
<code>provisioning-config.yaml</code> file mrack passes the image
value to Beaker hub and tries to request distribution
based on the image value. This way we can bypass default
translations and use desired distribution specified like
the one in the example below.</p>
<p>Minimal configuration could look like this:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: beaker
    image: fedora
</code></pre></div>
<p>To trigger a hard reboot of a guest, <code>bkr system-power --action reboot</code>
command is executed.</p>
<p>.. warning::</p>
<div class="highlight"><pre><span></span><code>``bkr system-power`` command is executed on the runner, not
on the guest.
</code></pre></div>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Specify the distro directly
provision:
    how: beaker
    image: Fedora-37%
</code></pre></div>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Set custom whiteboard description (added in 1.30)
provision:
    how: beaker
    whiteboard: Just a smoke test for now
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/provision/mrack.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;beaker&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProvisionBeaker</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ProvisionPlugin</span><span class="p">[</span><span class="n">ProvisionBeakerData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision guest on Beaker system using mrack.</span>

<span class="sd">    Reserve a machine from the Beaker pool using the ``mrack``</span>
<span class="sd">    plugin. ``mrack`` is a multicloud provisioning library</span>
<span class="sd">    supporting multiple cloud services including Beaker.</span>

<span class="sd">    The following two files are used for configuration:</span>

<span class="sd">    ``/etc/tmt/mrack.conf`` for basic configuration</span>

<span class="sd">    ``/etc/tmt/provisioning-config.yaml`` configuration per supported provider</span>

<span class="sd">    Beaker installs distribution specified by the ``image``</span>
<span class="sd">    key. If the image can not be translated using the</span>
<span class="sd">    ``provisioning-config.yaml`` file mrack passes the image</span>
<span class="sd">    value to Beaker hub and tries to request distribution</span>
<span class="sd">    based on the image value. This way we can bypass default</span>
<span class="sd">    translations and use desired distribution specified like</span>
<span class="sd">    the one in the example below.</span>

<span class="sd">    Minimal configuration could look like this:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: beaker</span>
<span class="sd">            image: fedora</span>

<span class="sd">    To trigger a hard reboot of a guest, ``bkr system-power --action reboot``</span>
<span class="sd">    command is executed.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        ``bkr system-power`` command is executed on the runner, not</span>
<span class="sd">        on the guest.</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Specify the distro directly</span>
<span class="sd">        provision:</span>
<span class="sd">            how: beaker</span>
<span class="sd">            image: Fedora-37%</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Set custom whiteboard description (added in 1.30)</span>
<span class="sd">        provision:</span>
<span class="sd">            how: beaker</span>
<span class="sd">            whiteboard: Just a smoke test for now</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ProvisionBeakerData</span>
    <span class="n">_guest_class</span> <span class="o">=</span> <span class="n">GuestBeaker</span>

    <span class="c1"># _thread_safe = True</span>

    <span class="c1"># Guest instance</span>
    <span class="n">_guest</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># data argument should be a &quot;Optional[GuestData]&quot; type but we would like to use</span>
    <span class="c1"># BeakerGuestData created here ignoring the override will make mypy calm</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wake</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BeakerGuestData</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wake up the plugin, process data, apply options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wake</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestBeaker</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provision the guest</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">BeakerGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">report_support</span><span class="p">(</span>
                <span class="n">names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">_CONSTRAINT_TRANSFORMERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestBeaker</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.mrack.ProvisionBeaker.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.mrack.ProvisionBeaker.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Provision the guest</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/mrack.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision the guest</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">BeakerGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">report_support</span><span class="p">(</span>
            <span class="n">names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">_CONSTRAINT_TRANSFORMERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestBeaker</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.mrack.ProvisionBeaker.wake" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wake</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.mrack.ProvisionBeaker.wake" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wake up the plugin, process data, apply options</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/mrack.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wake</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BeakerGuestData</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wake up the plugin, process data, apply options</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wake</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestBeaker</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="bootc">bootc<a class="headerlink" href="#bootc" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.provision.bootc.ProvisionBootc" class="doc doc-heading">
            <code>tmt.steps.provision.bootc.ProvisionBootc</code>


<a href="#tmt.steps.provision.bootc.ProvisionBootc" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.provision.ProvisionPlugin">ProvisionPlugin</span>[<span title="tmt.steps.provision.bootc.BootcData">BootcData</span>]</code></p>


        <p>Provision a local virtual machine using a bootc container image</p>
<p>Minimal config which uses the CentOS Stream 9 bootc image:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: bootc
    container-image: quay.io/centos-bootc/centos-bootc:stream9
    rootfs: xfs
</code></pre></div>
<p>Here's a config example using a Containerfile:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: bootc
    container-file: &quot;./my-custom-image.containerfile&quot;
    container-file-workdir: .
    image-builder: quay.io/centos-bootc/bootc-image-builder:stream9
    rootfs: ext4
    disk: 100
</code></pre></div>
<p>Another config example using an image that already includes tmt
dependencies:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: bootc
    add-tmt-dependencies: false
    container-image: localhost/my-image-with-deps
    rootfs: btrfs
</code></pre></div>
<p>This plugin is an extension of the virtual.testcloud plugin.
Essentially, it takes a container image as input, builds a
bootc disk image from the container image, then uses the virtual.testcloud
plugin to create a virtual machine using the bootc disk image.</p>
<p>The bootc disk creation requires running podman as root. The plugin will
automatically check if the current podman connection is rootless. If it is,
a podman machine will be spun up and used to build the bootc disk.</p>
<p>To trigger hard reboot of a guest, plugin uses testcloud API. It is
also used to trigger soft reboot unless a custom reboot command was
specified via <code>tmt-reboot -c ...</code>.</p>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/provision/bootc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;bootc&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProvisionBootc</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ProvisionPlugin</span><span class="p">[</span><span class="n">BootcData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision a local virtual machine using a bootc container image</span>

<span class="sd">    Minimal config which uses the CentOS Stream 9 bootc image:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: bootc</span>
<span class="sd">            container-image: quay.io/centos-bootc/centos-bootc:stream9</span>
<span class="sd">            rootfs: xfs</span>

<span class="sd">    Here&#39;s a config example using a Containerfile:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: bootc</span>
<span class="sd">            container-file: &quot;./my-custom-image.containerfile&quot;</span>
<span class="sd">            container-file-workdir: .</span>
<span class="sd">            image-builder: quay.io/centos-bootc/bootc-image-builder:stream9</span>
<span class="sd">            rootfs: ext4</span>
<span class="sd">            disk: 100</span>

<span class="sd">    Another config example using an image that already includes tmt</span>
<span class="sd">    dependencies:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: bootc</span>
<span class="sd">            add-tmt-dependencies: false</span>
<span class="sd">            container-image: localhost/my-image-with-deps</span>
<span class="sd">            rootfs: btrfs</span>

<span class="sd">    This plugin is an extension of the virtual.testcloud plugin.</span>
<span class="sd">    Essentially, it takes a container image as input, builds a</span>
<span class="sd">    bootc disk image from the container image, then uses the virtual.testcloud</span>
<span class="sd">    plugin to create a virtual machine using the bootc disk image.</span>

<span class="sd">    The bootc disk creation requires running podman as root. The plugin will</span>
<span class="sd">    automatically check if the current podman connection is rootless. If it is,</span>
<span class="sd">    a podman machine will be spun up and used to build the bootc disk.</span>

<span class="sd">    To trigger hard reboot of a guest, plugin uses testcloud API. It is</span>
<span class="sd">    also used to trigger soft reboot unless a custom reboot command was</span>
<span class="sd">    specified via ``tmt-reboot -c ...``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">BootcData</span>
    <span class="n">_guest_class</span> <span class="o">=</span> <span class="n">GuestTestcloud</span>
    <span class="n">_guest</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_rootless</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_in_standalone_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable standalone mode when build_disk_image_only is True</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">build_disk_image_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">is_in_standalone_mode</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># FIXME: cast() - https://github.com/teemtee/tmt/issues/1372</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">Provision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">parent</span><span class="o">.</span><span class="n">plan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">parent</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">parent</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">unique_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">parent</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">unique_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_expand_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expand the path to the full path relative to the current working dir</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">relative_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">relative_path</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">relative_path</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_derived_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_image</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a &quot;derived&quot; container image from the base image with tmt dependencies added</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># narrow type</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Build modified container image with necessary tmt packages/config.&quot;</span><span class="p">)</span>
        <span class="n">containerfile_template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            FROM {{ base_image }}</span>

<span class="s1">            RUN </span><span class="se">\</span>
<span class="s1">            dnf -y install cloud-init rsync &amp;&amp; </span><span class="se">\</span>
<span class="s1">            ln -s ../cloud-init.target /usr/lib/systemd/system/default.target.wants &amp;&amp; </span><span class="se">\</span>
<span class="s1">            rm /usr/local -rf &amp;&amp; ln -sr /var/usrlocal /usr/local &amp;&amp; mkdir -p /var/usrlocal/bin &amp;&amp; </span><span class="se">\</span>
<span class="s1">            dnf clean all</span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="n">containerfile_parsed</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="n">containerfile_template</span><span class="p">,</span> <span class="n">base_image</span><span class="o">=</span><span class="n">base_image</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="s1">&#39;Containerfile&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">containerfile_parsed</span><span class="p">)</span>

        <span class="n">image_tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;localhost/tmtmodified-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_id</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span>
            <span class="s2">&quot;podman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;build&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="si">}</span><span class="s1">/Containerfile&#39;</span><span class="p">,</span>
            <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
            <span class="n">image_tag</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
            <span class="n">stream_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">env</span><span class="o">=</span><span class="n">PODMAN_ENV</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">image_tag</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_base_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">containerfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">workdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the &quot;base&quot; or user supplied container image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">image_tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;localhost/tmtbase-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_id</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Build container image.&quot;</span><span class="p">)</span>
        <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span>
            <span class="s2">&quot;podman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;build&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_path</span><span class="p">(</span><span class="n">workdir</span><span class="p">),</span>
            <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_path</span><span class="p">(</span><span class="n">containerfile</span><span class="p">),</span>
            <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
            <span class="n">image_tag</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
            <span class="n">stream_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">env</span><span class="o">=</span><span class="n">PODMAN_ENV</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">image_tag</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_bootc_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">containerimage</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image_builder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rootfs</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the bootc disk from a container image using bootc image builder</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Build bootc disk image.&quot;</span><span class="p">)</span>

        <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span>
            <span class="s2">&quot;podman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;run&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--rm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--privileged&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CONTAINER_STORAGE_DIR</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">CONTAINER_STORAGE_DIR</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s2">&quot;--security-opt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;label=type:unconfined_t&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="si">}</span><span class="s2">:/output&quot;</span><span class="p">,</span>
            <span class="n">image_builder</span><span class="p">,</span>
            <span class="s2">&quot;build&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;qcow2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--rootfs&quot;</span><span class="p">,</span>
            <span class="n">rootfs</span><span class="p">,</span>
            <span class="s2">&quot;--local&quot;</span><span class="p">,</span>
            <span class="n">containerimage</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
            <span class="n">stream_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">env</span><span class="o">=</span><span class="n">PODMAN_ENV</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_podman_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;podman&quot;</span><span class="p">,</span> <span class="s2">&quot;machine&quot;</span><span class="p">,</span> <span class="s2">&quot;rm&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="n">PODMAN_MACHINE_NAME</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">stream_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Unable to remove existing podman machine (it might not exist).&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initialize podman machine.&quot;</span><span class="p">)</span>
        <span class="c1"># fmt: off</span>
        <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span>
            <span class="s2">&quot;podman&quot;</span><span class="p">,</span> <span class="s2">&quot;machine&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="s2">&quot;--rootful&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--disk-size&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_PODMAN_MACHINE_DISK_SIZE</span><span class="o">.</span><span class="n">magnitude</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--memory&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_PODMAN_MACHINE_MEM</span><span class="o">.</span><span class="n">magnitude</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--cpus&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_PODMAN_MACHINE_CPU</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DEFAULT_TMP_PATH</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">DEFAULT_TMP_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;$HOME:$HOME&quot;</span><span class="p">,</span>
            <span class="n">PODMAN_MACHINE_NAME</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">stream_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>
        <span class="c1"># fmt: on</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Start podman machine.&quot;</span><span class="p">)</span>
        <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;podman&quot;</span><span class="p">,</span> <span class="s2">&quot;machine&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">PODMAN_MACHINE_NAME</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">stream_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_if_podman_is_rootless</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span>
            <span class="s2">&quot;podman&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="s2">&quot;{{.Host.Security.Rootless}}&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">stream_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">stdout</span> <span class="o">==</span> <span class="s2">&quot;true</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provision the bootc instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_podman_is_rootless</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">BootcData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_podman_machine</span><span class="p">()</span>

        <span class="c1"># Image of file have to provided</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">container_image</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">container_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ProvisionError</span><span class="p">(</span>
                <span class="s2">&quot;Either &#39;container-file&#39; or &#39;container-image&#39; must be specified.&quot;</span>
            <span class="p">)</span>

        <span class="n">containerimage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
            <span class="c1"># Use provided container image</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">container_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">containerimage</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">container_image</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">add_tmt_dependencies</span><span class="p">:</span>
                    <span class="n">containerimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_derived_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">container_image</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_bootc_disk</span><span class="p">(</span><span class="n">containerimage</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">image_builder</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">rootfs</span><span class="p">)</span>

            <span class="c1"># Build image according to the container file</span>
            <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">container_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">containerimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_base_image</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">container_file</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">container_file_workdir</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">add_tmt_dependencies</span><span class="p">:</span>
                    <span class="n">containerimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_derived_image</span><span class="p">(</span><span class="n">containerimage</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_bootc_disk</span><span class="p">(</span><span class="n">containerimage</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">image_builder</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">rootfs</span><span class="p">)</span>

        <span class="c1"># Set unique disk file name, each plan will have its own disk file</span>
        <span class="n">disk_file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
            <span class="n">render_template</span><span class="p">(</span>
                <span class="s1">&#39;disk-{{ PHASE.parent.plan.my_run.unique_id }}&#39;</span>
                <span class="s1">&#39;-{{ PHASE.parent.plan.pathless_safe_name }}&#39;</span>
                <span class="s1">&#39;-{{ PHASE.safe_name }}.qcow2&#39;</span><span class="p">,</span>
                <span class="n">PHASE</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">image_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="s1">&#39;qcow2&#39;</span>

        <span class="c1"># Rename disk file name to unique file name</span>
        <span class="n">built_image</span> <span class="o">=</span> <span class="n">image_dir</span> <span class="o">/</span> <span class="s1">&#39;disk.qcow2&#39;</span>
        <span class="n">renamed_image</span> <span class="o">=</span> <span class="n">image_dir</span> <span class="o">/</span> <span class="n">disk_file_name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
            <span class="n">built_image</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">renamed_image</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">renamed_image</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">build_disk_image_only</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The disk image is converted and saved&quot;</span><span class="p">)</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestBootc</span><span class="p">(</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
            <span class="n">containerimage</span><span class="o">=</span><span class="n">containerimage</span><span class="p">,</span>
            <span class="n">rootless</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="tmt.steps.provision.bootc.ProvisionBootc.is_in_standalone_mode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_in_standalone_mode</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tmt.steps.provision.bootc.ProvisionBootc.is_in_standalone_mode" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Enable standalone mode when build_disk_image_only is True</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.bootc.ProvisionBootc.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.bootc.ProvisionBootc.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Provision the bootc instance</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/bootc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision the bootc instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_podman_is_rootless</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">BootcData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_podman_machine</span><span class="p">()</span>

    <span class="c1"># Image of file have to provided</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">container_image</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">container_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ProvisionError</span><span class="p">(</span>
            <span class="s2">&quot;Either &#39;container-file&#39; or &#39;container-image&#39; must be specified.&quot;</span>
        <span class="p">)</span>

    <span class="n">containerimage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
        <span class="c1"># Use provided container image</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">container_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">containerimage</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">container_image</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">add_tmt_dependencies</span><span class="p">:</span>
                <span class="n">containerimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_derived_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">container_image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_bootc_disk</span><span class="p">(</span><span class="n">containerimage</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">image_builder</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">rootfs</span><span class="p">)</span>

        <span class="c1"># Build image according to the container file</span>
        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">container_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">containerimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_base_image</span><span class="p">(</span>
                <span class="n">data</span><span class="o">.</span><span class="n">container_file</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">container_file_workdir</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">add_tmt_dependencies</span><span class="p">:</span>
                <span class="n">containerimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_derived_image</span><span class="p">(</span><span class="n">containerimage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_bootc_disk</span><span class="p">(</span><span class="n">containerimage</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">image_builder</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">rootfs</span><span class="p">)</span>

    <span class="c1"># Set unique disk file name, each plan will have its own disk file</span>
    <span class="n">disk_file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
        <span class="n">render_template</span><span class="p">(</span>
            <span class="s1">&#39;disk-{{ PHASE.parent.plan.my_run.unique_id }}&#39;</span>
            <span class="s1">&#39;-{{ PHASE.parent.plan.pathless_safe_name }}&#39;</span>
            <span class="s1">&#39;-{{ PHASE.safe_name }}.qcow2&#39;</span><span class="p">,</span>
            <span class="n">PHASE</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">image_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">/</span> <span class="s1">&#39;qcow2&#39;</span>

    <span class="c1"># Rename disk file name to unique file name</span>
    <span class="n">built_image</span> <span class="o">=</span> <span class="n">image_dir</span> <span class="o">/</span> <span class="s1">&#39;disk.qcow2&#39;</span>
    <span class="n">renamed_image</span> <span class="o">=</span> <span class="n">image_dir</span> <span class="o">/</span> <span class="n">disk_file_name</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dry_run</span><span class="p">:</span>
        <span class="n">built_image</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">renamed_image</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">renamed_image</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">build_disk_image_only</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The disk image is converted and saved&quot;</span><span class="p">)</span>
        <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestBootc</span><span class="p">(</span>
        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
        <span class="n">containerimage</span><span class="o">=</span><span class="n">containerimage</span><span class="p">,</span>
        <span class="n">rootless</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rootless</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="connect">connect<a class="headerlink" href="#connect" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.provision.connect.ProvisionConnect" class="doc doc-heading">
            <code>tmt.steps.provision.connect.ProvisionConnect</code>


<a href="#tmt.steps.provision.connect.ProvisionConnect" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.provision.ProvisionPlugin">ProvisionPlugin</span>[<span title="tmt.steps.provision.connect.ProvisionConnectData">ProvisionConnectData</span>]</code></p>


        <p>Connect to a provisioned guest using SSH.</p>
<p>Do not provision any system, tests will be executed directly on the
machine that has been already provisioned. Use provided
authentication information to connect to it over SSH.</p>
<p>Private key authentication (using <code>sudo</code> to run scripts):</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: connect
    guest: host.example.org
    user: fedora
    become: true
    key: /home/psss/.ssh/example_rsa
</code></pre></div>
<p>Password authentication:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: connect
    guest: host.example.org
    user: root
    password: secret
</code></pre></div>
<p>User defaults to <code>root</code>, so if you have private key correctly set
the minimal configuration can look like this:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: connect
    guest: host.example.org
</code></pre></div>
<p>To support hard reboot of a guest, <code>hard-reboot</code> must be set to
an executable command or script. Without this key set, hard reboot
will remain unsupported and result in an error. In comparison,
<code>soft-reboot</code> is optional, but if set, the given command will be
preferred over the default soft reboot command, <code>reboot</code>:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
  how: connect
  hard-reboot: virsh reboot my-example-vm
  soft-reboot: ssh root@my-example-vm &#39;shutdown -r now&#39;
</code></pre></div>
<p>.. code-block:: shell</p>
<div class="highlight"><pre><span></span><code>provision --how connect \
          --hard-reboot=&quot;virsh reboot my-example-vm&quot; \
          --soft-reboot=&quot;ssh root@my-example-vm &#39;shutdown -r now&#39;&quot;
</code></pre></div>
<p>.. warning::</p>
<div class="highlight"><pre><span></span><code>Both ``hard-reboot`` and ``soft-reboot`` commands are executed
on the runner, not on the guest.
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/provision/connect.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProvisionConnect</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ProvisionPlugin</span><span class="p">[</span><span class="n">ProvisionConnectData</span><span class="p">]):</span>
    <span class="c1">#</span>
    <span class="c1"># This plugin docstring has been reviewed and updated to follow</span>
    <span class="c1"># our documentation best practices. When changing it, please make</span>
    <span class="c1"># sure new changes are following them as well.</span>
    <span class="c1">#</span>
    <span class="c1"># https://tmt.readthedocs.io/en/stable/contribute.html#docs</span>
    <span class="c1">#</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connect to a provisioned guest using SSH.</span>

<span class="sd">    Do not provision any system, tests will be executed directly on the</span>
<span class="sd">    machine that has been already provisioned. Use provided</span>
<span class="sd">    authentication information to connect to it over SSH.</span>



<span class="sd">    Private key authentication (using ``sudo`` to run scripts):</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: connect</span>
<span class="sd">            guest: host.example.org</span>
<span class="sd">            user: fedora</span>
<span class="sd">            become: true</span>
<span class="sd">            key: /home/psss/.ssh/example_rsa</span>

<span class="sd">    Password authentication:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: connect</span>
<span class="sd">            guest: host.example.org</span>
<span class="sd">            user: root</span>
<span class="sd">            password: secret</span>

<span class="sd">    User defaults to ``root``, so if you have private key correctly set</span>
<span class="sd">    the minimal configuration can look like this:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: connect</span>
<span class="sd">            guest: host.example.org</span>



<span class="sd">    To support hard reboot of a guest, ``hard-reboot`` must be set to</span>
<span class="sd">    an executable command or script. Without this key set, hard reboot</span>
<span class="sd">    will remain unsupported and result in an error. In comparison,</span>
<span class="sd">    ``soft-reboot`` is optional, but if set, the given command will be</span>
<span class="sd">    preferred over the default soft reboot command, ``reboot``:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">          how: connect</span>
<span class="sd">          hard-reboot: virsh reboot my-example-vm</span>
<span class="sd">          soft-reboot: ssh root@my-example-vm &#39;shutdown -r now&#39;</span>

<span class="sd">    .. code-block:: shell</span>

<span class="sd">        provision --how connect \\</span>
<span class="sd">                  --hard-reboot=&quot;virsh reboot my-example-vm&quot; \\</span>
<span class="sd">                  --soft-reboot=&quot;ssh root@my-example-vm &#39;shutdown -r now&#39;&quot;</span>

<span class="sd">    .. warning::</span>

<span class="sd">        Both ``hard-reboot`` and ``soft-reboot`` commands are executed</span>
<span class="sd">        on the runner, not on the guest.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ProvisionConnectData</span>
    <span class="n">_guest_class</span> <span class="o">=</span> <span class="n">GuestConnect</span>

    <span class="n">_thread_safe</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Guest instance</span>
    <span class="n">_guest</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the connection</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="c1"># Check guest and auth info</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">guest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">SpecificationError</span><span class="p">(</span><span class="s1">&#39;Provide a host name or an ip address to connect.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">soft_reboot</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">hard_reboot</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_feeling_safe</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">GeneralError</span><span class="p">(</span>
                <span class="s2">&quot;Custom soft and hard reboot commands are allowed &quot;</span>
                <span class="s2">&quot;only with the &#39;--feeling-safe&#39; option.&quot;</span>
            <span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">ConnectGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Using password authentication.&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Using private key authentication.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;connect&#39; provision plugin does not support hardware requirements.&quot;</span><span class="p">)</span>

        <span class="c1"># And finally create the guest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestConnect</span><span class="p">(</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.connect.ProvisionConnect.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.connect.ProvisionConnect.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Prepare the connection</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/connect.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare the connection</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Check guest and auth info</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">guest</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">SpecificationError</span><span class="p">(</span><span class="s1">&#39;Provide a host name or an ip address to connect.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">soft_reboot</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">hard_reboot</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_feeling_safe</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">GeneralError</span><span class="p">(</span>
            <span class="s2">&quot;Custom soft and hard reboot commands are allowed &quot;</span>
            <span class="s2">&quot;only with the &#39;--feeling-safe&#39; option.&quot;</span>
        <span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ConnectGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Using password authentication.&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Using private key authentication.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;connect&#39; provision plugin does not support hardware requirements.&quot;</span><span class="p">)</span>

    <span class="c1"># And finally create the guest</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestConnect</span><span class="p">(</span>
        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="container">container<a class="headerlink" href="#container" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.provision.podman.ProvisionPodman" class="doc doc-heading">
            <code>tmt.steps.provision.podman.ProvisionPodman</code>


<a href="#tmt.steps.provision.podman.ProvisionPodman" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.provision.ProvisionPlugin">ProvisionPlugin</span>[<span title="tmt.steps.provision.podman.ProvisionPodmanData">ProvisionPodmanData</span>]</code></p>


        <p>Create a new container using <code>podman</code>.</p>
<p>Example config:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: container
    image: fedora:latest
</code></pre></div>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Use an image with a non-root user with sudo privileges,
# and run scripts with sudo.
provision:
    how: container
    image: image with non-root user with sudo privileges
    user: tester
    become: true
</code></pre></div>
<p>In order to always pull the fresh container image use <code>pull: true</code>.</p>
<p>In order to run the container with different user as the default <code>root</code>,
use <code>user: USER</code>.</p>
<p>Container-backed guests do not support soft reboots or custom reboot
commands. Soft reboot or <code>tmt-reboot -c ...</code> will result in an
error.</p>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/provision/podman.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span>
    <span class="s1">&#39;container&#39;</span><span class="p">,</span>
    <span class="n">installation_hint</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Make sure ``podman`` is installed and configured, it is required for container-backed</span>
<span class="s2">        guests provided by ``provision/container`` plugin.</span>

<span class="s2">        To quickly test ``podman`` functionality, you can try running ``podman images`` or</span>
<span class="s2">        ``podman run --rm -it fedora:latest``.</span>

<span class="s2">        * Users who installed tmt from system repositories should install</span>
<span class="s2">          ``tmt+provision-container`` package.</span>
<span class="s2">        * Users who installed tmt from PyPI should also install ``tmt+provision-container``</span>
<span class="s2">          package, as it will install required system dependencies. After doing so, they should</span>
<span class="s2">          install ``tmt[provision-container]`` extra.</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProvisionPodman</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ProvisionPlugin</span><span class="p">[</span><span class="n">ProvisionPodmanData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new container using ``podman``.</span>

<span class="sd">    Example config:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: container</span>
<span class="sd">            image: fedora:latest</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Use an image with a non-root user with sudo privileges,</span>
<span class="sd">        # and run scripts with sudo.</span>
<span class="sd">        provision:</span>
<span class="sd">            how: container</span>
<span class="sd">            image: image with non-root user with sudo privileges</span>
<span class="sd">            user: tester</span>
<span class="sd">            become: true</span>

<span class="sd">    In order to always pull the fresh container image use ``pull: true``.</span>

<span class="sd">    In order to run the container with different user as the default ``root``,</span>
<span class="sd">    use ``user: USER``.</span>

<span class="sd">    Container-backed guests do not support soft reboots or custom reboot</span>
<span class="sd">    commands. Soft reboot or ``tmt-reboot -c ...`` will result in an</span>
<span class="sd">    error.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ProvisionPodmanData</span>
    <span class="n">_guest_class</span> <span class="o">=</span> <span class="n">GuestContainer</span>

    <span class="n">_thread_safe</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Guest instance</span>
    <span class="n">_guest</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return default data for given option</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;pull&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">force_pull</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provision the container</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="c1"># Prepare data for the guest instance</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">PodmanGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;container&#39; provision plugin does not support hardware requirements.&quot;</span><span class="p">)</span>

        <span class="c1"># Create a new GuestTestcloud instance and start it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestContainer</span><span class="p">(</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

        <span class="c1"># TODO: this might be allowed with `--privileged`...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">capabilities</span><span class="p">[</span><span class="n">GuestCapability</span><span class="o">.</span><span class="n">SYSLOG_ACTION_READ_ALL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># ... while this seems to be forbidden completely.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">capabilities</span><span class="p">[</span><span class="n">GuestCapability</span><span class="o">.</span><span class="n">SYSLOG_ACTION_READ_CLEAR</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.podman.ProvisionPodman.default" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">default</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.podman.ProvisionPodman.default" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return default data for given option</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/podman.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return default data for given option</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;pull&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">force_pull</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.podman.ProvisionPodman.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.podman.ProvisionPodman.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Provision the container</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/podman.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision the container</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Prepare data for the guest instance</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">PodmanGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;container&#39; provision plugin does not support hardware requirements.&quot;</span><span class="p">)</span>

    <span class="c1"># Create a new GuestTestcloud instance and start it</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestContainer</span><span class="p">(</span>
        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

    <span class="c1"># TODO: this might be allowed with `--privileged`...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">capabilities</span><span class="p">[</span><span class="n">GuestCapability</span><span class="o">.</span><span class="n">SYSLOG_ACTION_READ_ALL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># ... while this seems to be forbidden completely.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">facts</span><span class="o">.</span><span class="n">capabilities</span><span class="p">[</span><span class="n">GuestCapability</span><span class="o">.</span><span class="n">SYSLOG_ACTION_READ_CLEAR</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="local">local<a class="headerlink" href="#local" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.provision.local.ProvisionLocal" class="doc doc-heading">
            <code>tmt.steps.provision.local.ProvisionLocal</code>


<a href="#tmt.steps.provision.local.ProvisionLocal" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.provision.ProvisionPlugin">ProvisionPlugin</span>[<span title="tmt.steps.provision.local.ProvisionLocalData">ProvisionLocalData</span>]</code></p>


        <p>Use the localhost for the test execution.</p>
<p>Do not provision any system, tests will be executed directly on the
localhost.</p>
<p>.. warning::</p>
<div class="highlight"><pre><span></span><code>In general, it is not recommended to run tests on your local
machine as there might be security risks. Run only those tests
which you know are safe so that you don&#39;t destroy your
workstation ;-)

From tmt version 1.38, the ``--feeling-safe`` option or
the ``TMT_FEELING_SAFE=1`` environment variable is
required in order to use the ``local`` provision plugin.
</code></pre></div>
<p>Using the plugin:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: local
</code></pre></div>
<p>.. code-block:: shell</p>
<div class="highlight"><pre><span></span><code>provision --how local
</code></pre></div>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>``tmt run`` is expected to be executed under a non-privileged
user account. For some actions on the localhost, e.g.
installation of test requirements, ``local`` will require
elevated privileges, either by running under ``root``
account, or by using ``sudo`` to run the sensitive commands. You
may be asked for a password in such cases.
</code></pre></div>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>Neither hard nor soft reboot is supported.
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/provision/local.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProvisionLocal</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ProvisionPlugin</span><span class="p">[</span><span class="n">ProvisionLocalData</span><span class="p">]):</span>
    <span class="c1">#</span>
    <span class="c1"># This plugin docstring has been reviewed and updated to follow</span>
    <span class="c1"># our documentation best practices. When changing it, please make</span>
    <span class="c1"># sure new changes are following them as well.</span>
    <span class="c1">#</span>
    <span class="c1"># https://tmt.readthedocs.io/en/stable/contribute.html#docs</span>
    <span class="c1">#</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the localhost for the test execution.</span>

<span class="sd">    Do not provision any system, tests will be executed directly on the</span>
<span class="sd">    localhost.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        In general, it is not recommended to run tests on your local</span>
<span class="sd">        machine as there might be security risks. Run only those tests</span>
<span class="sd">        which you know are safe so that you don&#39;t destroy your</span>
<span class="sd">        workstation ;-)</span>

<span class="sd">        From tmt version 1.38, the ``--feeling-safe`` option or</span>
<span class="sd">        the ``TMT_FEELING_SAFE=1`` environment variable is</span>
<span class="sd">        required in order to use the ``local`` provision plugin.</span>

<span class="sd">    Using the plugin:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: local</span>

<span class="sd">    .. code-block:: shell</span>

<span class="sd">        provision --how local</span>

<span class="sd">    .. note::</span>

<span class="sd">        ``tmt run`` is expected to be executed under a non-privileged</span>
<span class="sd">        user account. For some actions on the localhost, e.g.</span>
<span class="sd">        installation of test requirements, ``local`` will require</span>
<span class="sd">        elevated privileges, either by running under ``root``</span>
<span class="sd">        account, or by using ``sudo`` to run the sensitive commands. You</span>
<span class="sd">        may be asked for a password in such cases.</span>

<span class="sd">    .. note::</span>

<span class="sd">        Neither hard nor soft reboot is supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ProvisionLocalData</span>
    <span class="n">_guest_class</span> <span class="o">=</span> <span class="n">GuestLocal</span>

    <span class="n">_thread_safe</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Guest instance</span>
    <span class="n">_guest</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provision the container</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="c1"># Create a GuestLocal instance</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">GuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">primary_address</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>

        <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assert_feeling_safe</span><span class="p">(</span><span class="s2">&quot;1.38&quot;</span><span class="p">,</span> <span class="s2">&quot;The &#39;local&#39; provision plugin&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;local&#39; provision plugin does not support hardware requirements.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestLocal</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.local.ProvisionLocal.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.local.ProvisionLocal.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Provision the container</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/local.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision the container</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="c1"># Create a GuestLocal instance</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">GuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">primary_address</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>

    <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assert_feeling_safe</span><span class="p">(</span><span class="s2">&quot;1.38&quot;</span><span class="p">,</span> <span class="s2">&quot;The &#39;local&#39; provision plugin&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The &#39;local&#39; provision plugin does not support hardware requirements.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestLocal</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="virtualtestcloud">virtual.testcloud<a class="headerlink" href="#virtualtestcloud" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="tmt.steps.provision.testcloud.ProvisionTestcloud" class="doc doc-heading">
            <code>tmt.steps.provision.testcloud.ProvisionTestcloud</code>


<a href="#tmt.steps.provision.testcloud.ProvisionTestcloud" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tmt.steps.provision.ProvisionPlugin">ProvisionPlugin</span>[<span title="tmt.steps.provision.testcloud.ProvisionTestcloudData">ProvisionTestcloudData</span>]</code></p>


        <p>Local virtual machine using <code>testcloud</code> library.
Testcloud takes care of downloading an image and
making necessary changes to it for optimal experience
(such as disabling <code>UseDNS</code> and <code>GSSAPI</code> for SSH).</p>
<p>Minimal config which uses the latest Fedora image:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code>provision:
    how: virtual
</code></pre></div>
<p>Here's a full config example:</p>
<p>.. code-block:: yaml</p>
<div class="highlight"><pre><span></span><code># Provision a virtual machine from a specific QCOW2 file,
# using specific memory and disk settings, using the fedora user,
# and using sudo to run scripts.
provision:
    how: virtual
    image: https://mirror.vpsnet.com/fedora/linux/releases/41/Cloud/x86_64/images/Fedora-Cloud-Base-Generic-41-1.4.x86_64.qcow2
    user: fedora
    become: true
    # in MB
    memory: 2048
    # in GB
    disk: 30
</code></pre></div>
<p>Images
^^^^^^</p>
<p>As the image use <code>fedora</code> for the latest released Fedora compose,
<code>fedora-rawhide</code> for the latest Rawhide compose, short aliases such as
<code>fedora-32</code>, <code>f-32</code> or <code>f32</code> for specific release or a full url to
the qcow2 image for example from https://kojipkgs.fedoraproject.org/compose/.</p>
<p>Short names are also provided for <code>centos</code>, <code>centos-stream</code>, <code>alma</code>,
<code>rocky</code>, <code>oracle</code>, <code>debian</code> and <code>ubuntu</code> (e.g. <code>centos-8</code> or <code>c8</code>).</p>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code>The non-rpm distros are not fully supported yet in tmt as
the package installation is performed solely using ``dnf``/``yum``
and ``rpm``.
But you should be able the login to the provisioned guest and start
experimenting. Full support is coming in the future :)
</code></pre></div>
<p>Supported Fedora CoreOS images are:</p>
<ul>
<li><code>fedora-coreos</code></li>
<li><code>fedora-coreos-stable</code></li>
<li><code>fedora-coreos-testing</code></li>
<li><code>fedora-coreos-next</code></li>
</ul>
<p>Use the full path for images stored on local disk, for example:</p>
<p>.. code-block:: shell</p>
<div class="highlight"><pre><span></span><code>/var/tmp/images/Fedora-Cloud-Base-31-1.9.x86_64.qcow2
</code></pre></div>
<p>In addition to the qcow2 format, Vagrant boxes can be used as well,
testcloud will take care of unpacking the image for you.</p>
<p>Reboot
^^^^^^</p>
<p>To trigger hard reboot of a guest, plugin uses testcloud API. It is
also used to trigger soft reboot unless a custom reboot command was
specified via <code>tmt-reboot -c ...</code>.</p>
<p>Console
^^^^^^^</p>
<p>The full console log is available, after the guest is booted, in the
<code>logs</code> directory under the provision step workdir, for example:
<code>plan/provision/client/logs/console.txt</code>. Enable verbose mode
using <code>-vv</code> to get the full path printed to the terminal for easy
investigation.</p>







              <details class="quote">
                <summary>Source code in <code>tmt/steps/provision/testcloud.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provides_method</span><span class="p">(</span>
    <span class="s1">&#39;virtual.testcloud&#39;</span><span class="p">,</span>
    <span class="n">installation_hint</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Make sure ``testcloud`` and ``libvirt`` packages are installed and configured, they are</span>
<span class="s2">        required for VM-backed guests provided by ``provision/virtual.testcloud`` plugin.</span>

<span class="s2">        * Users who installed tmt from system repositories should install ``tmt+provision-virtual``</span>
<span class="s2">          package.</span>
<span class="s2">        * Users who installed tmt from PyPI should also install ``tmt+provision-virtual`` package,</span>
<span class="s2">          as it will install required system dependencies. After doing so, they should install</span>
<span class="s2">          ``tmt[provision-virtual]`` extra.</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProvisionTestcloud</span><span class="p">(</span><span class="n">tmt</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">provision</span><span class="o">.</span><span class="n">ProvisionPlugin</span><span class="p">[</span><span class="n">ProvisionTestcloudData</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Local virtual machine using ``testcloud`` library.</span>
<span class="sd">    Testcloud takes care of downloading an image and</span>
<span class="sd">    making necessary changes to it for optimal experience</span>
<span class="sd">    (such as disabling ``UseDNS`` and ``GSSAPI`` for SSH).</span>

<span class="sd">    Minimal config which uses the latest Fedora image:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        provision:</span>
<span class="sd">            how: virtual</span>

<span class="sd">    Here&#39;s a full config example:</span>

<span class="sd">    .. code-block:: yaml</span>

<span class="sd">        # Provision a virtual machine from a specific QCOW2 file,</span>
<span class="sd">        # using specific memory and disk settings, using the fedora user,</span>
<span class="sd">        # and using sudo to run scripts.</span>
<span class="sd">        provision:</span>
<span class="sd">            how: virtual</span>
<span class="sd">            image: https://mirror.vpsnet.com/fedora/linux/releases/41/Cloud/x86_64/images/Fedora-Cloud-Base-Generic-41-1.4.x86_64.qcow2</span>
<span class="sd">            user: fedora</span>
<span class="sd">            become: true</span>
<span class="sd">            # in MB</span>
<span class="sd">            memory: 2048</span>
<span class="sd">            # in GB</span>
<span class="sd">            disk: 30</span>

<span class="sd">    Images</span>
<span class="sd">    ^^^^^^</span>

<span class="sd">    As the image use ``fedora`` for the latest released Fedora compose,</span>
<span class="sd">    ``fedora-rawhide`` for the latest Rawhide compose, short aliases such as</span>
<span class="sd">    ``fedora-32``, ``f-32`` or ``f32`` for specific release or a full url to</span>
<span class="sd">    the qcow2 image for example from https://kojipkgs.fedoraproject.org/compose/.</span>

<span class="sd">    Short names are also provided for ``centos``, ``centos-stream``, ``alma``,</span>
<span class="sd">    ``rocky``, ``oracle``, ``debian`` and ``ubuntu`` (e.g. ``centos-8`` or ``c8``).</span>

<span class="sd">    .. note::</span>

<span class="sd">        The non-rpm distros are not fully supported yet in tmt as</span>
<span class="sd">        the package installation is performed solely using ``dnf``/``yum``</span>
<span class="sd">        and ``rpm``.</span>
<span class="sd">        But you should be able the login to the provisioned guest and start</span>
<span class="sd">        experimenting. Full support is coming in the future :)</span>

<span class="sd">    Supported Fedora CoreOS images are:</span>

<span class="sd">    * ``fedora-coreos``</span>
<span class="sd">    * ``fedora-coreos-stable``</span>
<span class="sd">    * ``fedora-coreos-testing``</span>
<span class="sd">    * ``fedora-coreos-next``</span>

<span class="sd">    Use the full path for images stored on local disk, for example:</span>

<span class="sd">    .. code-block:: shell</span>

<span class="sd">        /var/tmp/images/Fedora-Cloud-Base-31-1.9.x86_64.qcow2</span>

<span class="sd">    In addition to the qcow2 format, Vagrant boxes can be used as well,</span>
<span class="sd">    testcloud will take care of unpacking the image for you.</span>

<span class="sd">    Reboot</span>
<span class="sd">    ^^^^^^</span>

<span class="sd">    To trigger hard reboot of a guest, plugin uses testcloud API. It is</span>
<span class="sd">    also used to trigger soft reboot unless a custom reboot command was</span>
<span class="sd">    specified via ``tmt-reboot -c ...``.</span>

<span class="sd">    Console</span>
<span class="sd">    ^^^^^^^</span>

<span class="sd">    The full console log is available, after the guest is booted, in the</span>
<span class="sd">    ``logs`` directory under the provision step workdir, for example:</span>
<span class="sd">    ``plan/provision/client/logs/console.txt``. Enable verbose mode</span>
<span class="sd">    using ``-vv`` to get the full path printed to the terminal for easy</span>
<span class="sd">    investigation.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_class</span> <span class="o">=</span> <span class="n">ProvisionTestcloudData</span>
    <span class="n">_guest_class</span> <span class="o">=</span> <span class="n">GuestTestcloud</span>

    <span class="n">_thread_safe</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Guest instance</span>
    <span class="n">_guest</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provision the testcloud instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">list_local_images</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_local_images</span><span class="p">()</span>
            <span class="c1"># Clean up the run workdir and exit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">_workdir_cleanup</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Give info about provided data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">TestcloudGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Once plan schema is enforced this won&#39;t be necessary</span>
        <span class="c1"># click enforces int for cmdline and schema validation</span>
        <span class="c1"># will make sure &#39;int&#39; gets from plan data.</span>
        <span class="c1"># Another key is &#39;port&#39; however that is not exposed to the cli</span>
        <span class="k">for</span> <span class="n">int_key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">int_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">int_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">NormalizationError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">int_key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;an integer&#39;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">report_support</span><span class="p">(</span><span class="n">check</span><span class="o">=</span><span class="n">_report_hw_requirement_support</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">format_variants</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;hardware&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">memory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">uses_constraint</span><span class="p">(</span>
                <span class="s1">&#39;memory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Hardware requirement &#39;memory&#39; is specified in &#39;hardware&#39; key,&quot;</span>
                    <span class="s2">&quot; it will be overruled by &#39;memory&#39; key.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">disk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">uses_constraint</span><span class="p">(</span>
                <span class="s1">&#39;disk.size&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Hardware requirement &#39;disk.size&#39; is specified in &#39;hardware&#39; key,&quot;</span>
                    <span class="s2">&quot; it will be overruled by &#39;disk&#39; key.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Create a new GuestTestcloud instance and start it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestTestcloud</span><span class="p">(</span>
            <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_print_local_images</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print images which are already cached</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">store_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir_root</span> <span class="o">/</span> <span class="s1">&#39;testcloud/images&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Locally available images&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">store_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.qcow2&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">store_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean_images</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clean</span><span class="p">:</span> <span class="s1">&#39;tmt.base.Clean&#39;</span><span class="p">,</span> <span class="n">dry</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">workdir_root</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the testcloud images</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">testcloud_images</span> <span class="o">=</span> <span class="n">workdir_root</span> <span class="o">/</span> <span class="s1">&#39;testcloud/images&#39;</span>
        <span class="n">clean</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;testcloud&#39;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">testcloud_images</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">clean</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">testcloud_images</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">successful</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">testcloud_images</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
                <span class="n">clean</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Would remove &#39;</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clean</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing &#39;</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">image</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="n">clean</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove &#39;</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">successful</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">successful</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.testcloud.ProvisionTestcloud.clean_images" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_images</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">dry</span><span class="p">,</span> <span class="n">workdir_root</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tmt.steps.provision.testcloud.ProvisionTestcloud.clean_images" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove the testcloud images</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/testcloud.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clean_images</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clean</span><span class="p">:</span> <span class="s1">&#39;tmt.base.Clean&#39;</span><span class="p">,</span> <span class="n">dry</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">workdir_root</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove the testcloud images</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">testcloud_images</span> <span class="o">=</span> <span class="n">workdir_root</span> <span class="o">/</span> <span class="s1">&#39;testcloud/images&#39;</span>
    <span class="n">clean</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;testcloud&#39;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">testcloud_images</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">clean</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">testcloud_images</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">testcloud_images</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
            <span class="n">clean</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Would remove &#39;</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clean</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing &#39;</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">image</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">clean</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove &#39;</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">successful</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">successful</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="tmt.steps.provision.testcloud.ProvisionTestcloud.go" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">go</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tmt.steps.provision.testcloud.ProvisionTestcloud.go" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Provision the testcloud instance</p>


            <details class="quote">
              <summary>Source code in <code>tmt/steps/provision/testcloud.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tmt</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provision the testcloud instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">list_local_images</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_local_images</span><span class="p">()</span>
        <span class="c1"># Clean up the run workdir and exit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">my_run</span><span class="o">.</span><span class="n">_workdir_cleanup</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Give info about provided data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">TestcloudGuestData</span><span class="o">.</span><span class="n">from_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Once plan schema is enforced this won&#39;t be necessary</span>
    <span class="c1"># click enforces int for cmdline and schema validation</span>
    <span class="c1"># will make sure &#39;int&#39; gets from plan data.</span>
    <span class="c1"># Another key is &#39;port&#39; however that is not exposed to the cli</span>
    <span class="k">for</span> <span class="n">int_key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">int_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">int_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">tmt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">NormalizationError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">int_key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;an integer&#39;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">report_support</span><span class="p">(</span><span class="n">check</span><span class="o">=</span><span class="n">_report_hw_requirement_support</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">format_variants</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;hardware&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">memory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">uses_constraint</span><span class="p">(</span>
            <span class="s1">&#39;memory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Hardware requirement &#39;memory&#39; is specified in &#39;hardware&#39; key,&quot;</span>
                <span class="s2">&quot; it will be overruled by &#39;memory&#39; key.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">disk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">uses_constraint</span><span class="p">(</span>
            <span class="s1">&#39;disk.size&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Hardware requirement &#39;disk.size&#39; is specified in &#39;hardware&#39; key,&quot;</span>
                <span class="s2">&quot; it will be overruled by &#39;disk&#39; key.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Create a new GuestTestcloud instance and start it</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span> <span class="o">=</span> <span class="n">GuestTestcloud</span><span class="p">(</span>
        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_guest</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>













              </article>
            </div>


<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>




      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>


      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>


  </body>
</html>