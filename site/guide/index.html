
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">




        <link rel="prev" href="../overview/">


        <link rel="next" href="../plugins/">


      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">



        <title>Guide - tmt</title>



      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">












        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



      <link rel="stylesheet" href="../assets/_mkdocstrings.css">

    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>






  </head>


    <body dir="ltr">


    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#guide" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>






<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="tmt" class="md-header__button md-logo" aria-label="tmt" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">

      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tmt
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Guide

          </span>
        </div>
      </div>
    </div>


      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>





        <label class="md-header__button md-icon" for="__search">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>



      <div class="md-header__source">
        <a href="https://github.com/teemtee/tmt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>

  </nav>

</header>

    <div class="md-container" data-md-component="container">






      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="tmt" class="md-nav__button md-logo" aria-label="tmt" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    tmt
  </label>

    <div class="md-nav__source">
      <a href="https://github.com/teemtee/tmt" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>

  <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href=".." class="md-nav__link">



  <span class="md-ellipsis">
    Home

  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">



  <span class="md-ellipsis">
    Overview

  </span>


      </a>
    </li>











    <li class="md-nav__item md-nav__item--active">

      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">





        <label class="md-nav__link md-nav__link--active" for="__toc">



  <span class="md-ellipsis">
    Guide

  </span>


          <span class="md-nav__icon md-icon"></span>
        </label>

      <a href="./" class="md-nav__link md-nav__link--active">



  <span class="md-ellipsis">
    Guide

  </span>


      </a>



<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#the-first-steps" class="md-nav__link">
    <span class="md-ellipsis">
      The First Steps
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#under-the-hood" class="md-nav__link">
    <span class="md-ellipsis">
      Under The Hood
    </span>
  </a>

    <nav class="md-nav" aria-label="Under The Hood">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#trees" class="md-nav__link">
    <span class="md-ellipsis">
      Trees
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#plans" class="md-nav__link">
    <span class="md-ellipsis">
      Plans
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    <span class="md-ellipsis">
      Tests
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#stories" class="md-nav__link">
    <span class="md-ellipsis">
      Stories
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    <span class="md-ellipsis">
      Core
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#organize-data" class="md-nav__link">
    <span class="md-ellipsis">
      Organize Data
    </span>
  </a>

    <nav class="md-nav" aria-label="Organize Data">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      Create
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#custom-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Templates
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#lint" class="md-nav__link">
    <span class="md-ellipsis">
      Lint
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#inheritance" class="md-nav__link">
    <span class="md-ellipsis">
      Inheritance
    </span>
  </a>

    <nav class="md-nav" aria-label="Inheritance">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#virtual-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual Tests
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#inherit-plans" class="md-nav__link">
    <span class="md-ellipsis">
      Inherit Plans
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

          <li class="md-nav__item">
  <a href="#elasticity" class="md-nav__link">
    <span class="md-ellipsis">
      Elasticity
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#link-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Link Issues
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#share-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Share Tests
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#adjust-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust Metadata
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#anchors-and-aliases" class="md-nav__link">
    <span class="md-ellipsis">
      Anchors and Aliases
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#git-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Git Metadata
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#conditional-step-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Conditional step configuration
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#multihost-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Multihost Testing
    </span>
  </a>

    <nav class="md-nav" aria-label="Multihost Testing">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#rerunning-failed-tests-of-previously-executed-runs" class="md-nav__link">
    <span class="md-ellipsis">
      Rerunning failed tests of previously executed runs
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#synchronization-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization Libraries
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#current-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Current Limits
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>

    </li>














    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >


          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">



  <span class="md-ellipsis">
    Plugins

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">



  <span class="md-ellipsis">
    Overview

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../plugins/discover/" class="md-nav__link">



  <span class="md-ellipsis">
    Discover

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../plugins/provision/" class="md-nav__link">



  <span class="md-ellipsis">
    Provision

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../plugins/prepare/" class="md-nav__link">



  <span class="md-ellipsis">
    Prepare

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../plugins/execute/" class="md-nav__link">



  <span class="md-ellipsis">
    Execute

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../plugins/report/" class="md-nav__link">



  <span class="md-ellipsis">
    Report

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../plugins/finish/" class="md-nav__link">



  <span class="md-ellipsis">
    Finish

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#the-first-steps" class="md-nav__link">
    <span class="md-ellipsis">
      The First Steps
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#under-the-hood" class="md-nav__link">
    <span class="md-ellipsis">
      Under The Hood
    </span>
  </a>

    <nav class="md-nav" aria-label="Under The Hood">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#trees" class="md-nav__link">
    <span class="md-ellipsis">
      Trees
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#plans" class="md-nav__link">
    <span class="md-ellipsis">
      Plans
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#tests" class="md-nav__link">
    <span class="md-ellipsis">
      Tests
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#stories" class="md-nav__link">
    <span class="md-ellipsis">
      Stories
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    <span class="md-ellipsis">
      Core
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#organize-data" class="md-nav__link">
    <span class="md-ellipsis">
      Organize Data
    </span>
  </a>

    <nav class="md-nav" aria-label="Organize Data">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    <span class="md-ellipsis">
      Create
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#custom-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Templates
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#lint" class="md-nav__link">
    <span class="md-ellipsis">
      Lint
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#inheritance" class="md-nav__link">
    <span class="md-ellipsis">
      Inheritance
    </span>
  </a>

    <nav class="md-nav" aria-label="Inheritance">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#virtual-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual Tests
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#inherit-plans" class="md-nav__link">
    <span class="md-ellipsis">
      Inherit Plans
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

          <li class="md-nav__item">
  <a href="#elasticity" class="md-nav__link">
    <span class="md-ellipsis">
      Elasticity
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#link-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Link Issues
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#share-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Share Tests
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#adjust-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust Metadata
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#anchors-and-aliases" class="md-nav__link">
    <span class="md-ellipsis">
      Anchors and Aliases
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#git-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Git Metadata
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#conditional-step-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Conditional step configuration
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#multihost-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Multihost Testing
    </span>
  </a>

    <nav class="md-nav" aria-label="Multihost Testing">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#rerunning-failed-tests-of-previously-executed-runs" class="md-nav__link">
    <span class="md-ellipsis">
      Rerunning failed tests of previously executed runs
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#synchronization-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization Libraries
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#current-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Current Limits
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">








<h1 id="guide">Guide<a class="headerlink" href="#guide" title="Permanent link">&para;</a></h1>
<p>This guide will show you the way through the dense forest of
available <code>tmt</code> features, commands and options. But don't be
afraid, we will start slowly, with the simple examples first. And
then, when your eyes get accustomed to the shadow of omni-present
metadata <a href="https://fmf.readthedocs.io/en/stable/concept.html#trees">trees</a>, we will slowly dive deeper and deeper so that
you don't miss any essential functionality which could make your
life smarter, brighter and more joyful. Let's go, follow me...</p>
<h2 id="the-first-steps">The First Steps<a class="headerlink" href="#the-first-steps" title="Permanent link">&para;</a></h2>
<p>Installing the main package with the core functionality is quite
straightforward. No worry, the <code>/stories/install/minimal</code>
package has just a few dependencies:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>tmt
</code></pre></div>
<p>Enabling a simple smoke test in the continuous integration should
be a joy. Just a couple of concise commands, assuming you are in
your project git repository:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>init<span class="w"> </span>--template<span class="w"> </span>mini
vim<span class="w"> </span>plans/example.fmf
</code></pre></div>
<p>Open the example plan in your favorite editor and adjust the smoke
test script as needed. Your very first plan can look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Basic smoke test</span>
<span class="nt">execute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo --version</span>
</code></pre></div>
<p>Now you're ready to create a new pull request to check out how
it's working. During push, remote usually shows a direct link to
the page with a <em>Create</em> button, so now it's only two clicks
away:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>smoke-test
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Enable a simple smoke test&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>-u<span class="w"> </span>smoke-test
</code></pre></div>
<p>But perhaps, you are a little bit impatient and would like to see
the results faster. Sure, let's try the smoke test here and now,
directly on your localhost:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>--feeling-safe<span class="w"> </span>run<span class="w"> </span>--all<span class="w"> </span>provision<span class="w"> </span>--how<span class="w"> </span><span class="nb">local</span>
</code></pre></div>
<p>Note that the extra <code>--feeling-safe</code> option is needed for the
<code>/plugins/provision/local</code> provision plugin as it can be
dangerous to execute unknown code directly on your system. If
you're afraid that the test could break your machine or just want
to keep your environment clean, run it in a container instead:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>tmt+provision-container
tmt<span class="w"> </span>run<span class="w"> </span>-a<span class="w"> </span>provision<span class="w"> </span>-h<span class="w"> </span>container
</code></pre></div>
<p>Or even in a full virtual machine if the container environment is
not enough. We'll use the <code>libvirt</code> to start a new
virtual machine on your localhost. Be ready for a bit more
dependencies here:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>tmt+provision-virtual
tmt<span class="w"> </span>run<span class="w"> </span>-a<span class="w"> </span>provision<span class="w"> </span>-h<span class="w"> </span>virtual
</code></pre></div>
<p>Don't care about the disk space? Simply install <code>tmt+all</code> and
you'll get <code>/stories/install/all</code> available functionality at
hand. Check the help to list all supported provision methods:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>tmt+all
tmt<span class="w"> </span>run<span class="w"> </span>provision<span class="w"> </span>--help
</code></pre></div>
<p>Now when you've met your <code>--help</code> friend you know everything you
need to get around without getting lost in the forest of available
options:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>--help
tmt<span class="w"> </span>run<span class="w"> </span>--help
tmt<span class="w"> </span>run<span class="w"> </span>provision<span class="w"> </span>--help
tmt<span class="w"> </span>run<span class="w"> </span>provision<span class="w"> </span>--how<span class="w"> </span>container<span class="w"> </span>--help
</code></pre></div>
<p>Go on and explore. Don't be shy and ask, <code>--help</code> is eager to
answer all your questions ;-)</p>
<h2 id="under-the-hood">Under The Hood<a class="headerlink" href="#under-the-hood" title="Permanent link">&para;</a></h2>
<p>Now let's have a brief look under the hood. For storing all config
data we're using the <a href="https://fmf.readthedocs.io">Flexible Metadata Format</a>. In short, it is
a <code>yaml</code> format extended with a couple of nice features like
<code>inheritance</code> or <code>elasticity</code> which help to maintain
even large data efficiently without unnecessary duplication.</p>
<h3 id="trees">Trees<a class="headerlink" href="#trees" title="Permanent link">&para;</a></h3>
<p>The data are organized into <a href="https://fmf.readthedocs.io/en/stable/concept.html#trees">trees</a>. Similarly as with <code>git</code>,
there is a special <code>.fmf</code> directory which marks the root of the
fmf metadata tree. Use the <code>init</code> command to initialize it:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>init
</code></pre></div>
<p>Do not forget to include this special <code>.fmf</code> directory in your
commits, it is essential for building the fmf tree structure which
is created from all <code>*.fmf</code> files discovered under the fmf root.</p>
<h3 id="plans">Plans<a class="headerlink" href="#plans" title="Permanent link">&para;</a></h3>
<p>As we've seen above, in order to enable testing the following plan
is just enough:</p>
<div class="highlight"><pre><span></span><code><span class="nt">execute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo --version</span>
</code></pre></div>
<p>Store these two lines in a <code>*.fmf</code> file and that's it. Name and
location of the file is completely up to you, plans are recognized
by the <code>execute</code> key which is required. Once the newly created
plan is submitted to the CI system test script will be executed.</p>
<p>By the way, there are several basic templates available which can
be applied already during the <code>init</code> by using the <code>--template</code>
option or the short version <code>-t</code>. The minimal template, which
includes just a simple plan skeleton, is the fastest way to get
started:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>init<span class="w"> </span>-t<span class="w"> </span>mini
</code></pre></div>
<p><code>/spec/plans</code> are used to enable testing and group relevant
tests together. They describe how to <code>/spec/plans/discover</code>
tests for execution, how to <code>/spec/plans/provision</code> the
environment, how to <code>/spec/plans/prepare</code> it for testing, how
to <code>/spec/plans/execute</code> tests, <code>/spec/plans/report</code>
results and finally how to <code>/spec/plans/finish</code> the test job.</p>
<p>Here's an example of a slightly more complex plan which changes
the default provision method to container to speed up the testing
process and ensures that an additional package is installed before
the testing starts:</p>
<div class="highlight"><pre><span></span><code><span class="nt">provision</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fedora:33</span>
<span class="nt">prepare</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>
<span class="w">    </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wget</span>
<span class="nt">execute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt</span>
<span class="w">    </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wget http://example.org/</span>
</code></pre></div>
<p>Note that each of the steps above uses the <code>how</code> keyword to
choose the desired method which should be applied. Steps can
provide multiple implementations which enables you to choose the
best one for your use case. For example to prepare the guest it's
possible to use the <code>/plugins/prepare/install</code> method for
simple package installations, <code>/plugins/prepare/ansible</code>
for more complex system setup or <code>/plugins/prepare/shell</code>
for arbitrary shell commands.</p>
<h3 id="tests">Tests<a class="headerlink" href="#tests" title="Permanent link">&para;</a></h3>
<p>Very often testing is much more complex than running just a
single shell script. There might be many scenarios covered by
individual scripts. For these cases the <code>discover</code> step can
be instructed to explore available tests from fmf metadata as
well. The plan will look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">discover</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="nt">execute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt</span>
</code></pre></div>
<p><code>/spec/tests</code>, identified by the required key <code>test</code>,
define attributes which are closely related to individual test
cases such as the <code>/spec/tests/test</code> script,
<code>/spec/tests/framework</code>, directory <code>/spec/tests/path</code>
where the test should be executed, maximum test
<code>/spec/tests/duration</code> or packages
<code>required&lt;/spec/tests/require&gt;</code> to run the test. Here's an
example of test metadata:</p>
<div class="highlight"><pre><span></span><code><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fetch an example web page</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wget http://example.org/</span>
<span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wget</span>
<span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
</code></pre></div>
<p>Instead of writing the plan and test metadata manually, you might
want to simply apply the <code>base</code> template which contains the plan
mentioned above together with a test example including both test
metadata and test script skeleton for inspiration:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>init<span class="w"> </span>--template<span class="w"> </span>base
</code></pre></div>
<p>Similar to plans, it is possible to choose an arbitrary name for
the test. Just make sure the <code>test</code> key is defined. However, to
organize the metadata efficiently it is recommended to keep tests
and plans under separate folders, e.g. <code>tests</code> and <code>plans</code>.
This will also allow you to use <code>inheritance</code> to prevent
unnecessary data duplication.</p>
<h3 id="stories">Stories<a class="headerlink" href="#stories" title="Permanent link">&para;</a></h3>
<p>It's always good to start with a "why". Or, even better, with a
story which can describe more context behind the motivation.
<code>/spec/stories</code> can be used to track implementation, test and
documentation coverage for individual features or requirements.
Thanks to this you can track everything in one place, including
the project implementation progress. Stories are identified by the
<code>story</code> attribute which every story has to define or inherit.</p>
<p>An example story can look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">story</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">As a user I want to see more detailed information for</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">particular command.</span>
<span class="nt">example</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt tests show -v</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt tests show -vvv</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt tests show --verbose</span>
</code></pre></div>
<p>In order to start experimenting with the complete set of examples
covering all metadata levels, use the <code>full</code> template which
creates a test, a plan and a story:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>init<span class="w"> </span>-t<span class="w"> </span>full
</code></pre></div>
<h3 id="core">Core<a class="headerlink" href="#core" title="Permanent link">&para;</a></h3>
<p>Finally, there are certain metadata keys which can be used across
all levels. <code>/spec/core</code> attributes cover general metadata
such as <code>/spec/core/summary</code> or <code>/spec/core/description</code>
for describing the content, the <code>/spec/core/enabled</code>
attribute for disabling and enabling tests, plans and stories and
the <code>/spec/core/link</code> key which can be used for tracking
relations between objects.</p>
<p>Here's how the story above could be extended with the core
attributes <code>description</code> and <code>link</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Different verbose levels can be enabled by using the</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">option several times.</span>
<span class="nt">link</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">implemented-by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmt/cli.py</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">documented-by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmt/cli.py</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">verified-by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tests/core/dry</span>
</code></pre></div>
<p>Last but not least, the core attribute <code>/spec/core/adjust</code>
provides a flexible way to adjust metadata based on the
<code>/spec/context</code>. But this is rather a large topic, so let's
keep it for another time.</p>
<h2 id="organize-data">Organize Data<a class="headerlink" href="#organize-data" title="Permanent link">&para;</a></h2>
<p>In the previous chapter we've learned what <code>/spec/tests</code>,
<code>/spec/plans</code> and <code>/spec/stories</code> are used for. Now the
time has come to learn how to efficiently organize them in your
repository. First we'll describe how to easily <code>create</code> new
tests, plans and stories, how to use <code>lint</code> to verify that
all metadata have correct syntax. Finally, we'll dive into
<code>inheritance</code> and <code>elasticity</code> which can substantially
help you to minimize data duplication.</p>
<h3 id="create">Create<a class="headerlink" href="#create" title="Permanent link">&para;</a></h3>
<p>When working on the test coverage, one of the most common actions
is creating new tests. Use <code>tmt test create</code> to simply create a
new test based on a template:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tmt<span class="w"> </span><span class="nb">test</span><span class="w"> </span>create<span class="w"> </span>/tests/smoke
Template<span class="w"> </span><span class="o">(</span>shell<span class="w"> </span>or<span class="w"> </span>beakerlib<span class="o">)</span>:<span class="w"> </span>shell
Directory<span class="w"> </span><span class="s1">&#39;/home/psss/git/tmt/tests/smoke&#39;</span><span class="w"> </span>created.
Test<span class="w"> </span>metadata<span class="w"> </span><span class="s1">&#39;/home/psss/git/tmt/tests/smoke/main.fmf&#39;</span><span class="w"> </span>created.
Test<span class="w"> </span>script<span class="w"> </span><span class="s1">&#39;/home/psss/git/tmt/tests/smoke/test.sh&#39;</span><span class="w"> </span>created.
</code></pre></div>
<p>As for now there are two test <a href="https://github.com/teemtee/tmt/tree/main/tmt/templates">templates</a> available, <code>shell</code>
for simple scripts written in shell and <code>beakerlib</code> with a basic
skeleton demonstrating essential functions of this shell-level
testing framework. If you want to be faster, specify the desired
template directly on the command line using <code>--template</code> or
<code>-t</code>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tmt<span class="w"> </span><span class="nb">test</span><span class="w"> </span>create<span class="w"> </span>--template<span class="w"> </span>shell<span class="w"> </span>/tests/smoke
$<span class="w"> </span>tmt<span class="w"> </span><span class="nb">test</span><span class="w"> </span>create<span class="w"> </span>-t<span class="w"> </span>beakerlib<span class="w"> </span>/tests/smoke
</code></pre></div>
<p>To create multiple tests at once, you can specify multiple names
at the same time:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tmt<span class="w"> </span>tests<span class="w"> </span>create<span class="w"> </span>-t<span class="w"> </span>shell<span class="w"> </span>/tests/core<span class="w"> </span>/tests/base<span class="w"> </span>/tests/full
</code></pre></div>
<p>If you'd like to link relevant issues when creating a test, specify
the links via <code>[RELATION:]TARGET</code> on the command line using
<code>--link</code>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tmt<span class="w"> </span><span class="nb">test</span><span class="w"> </span>create<span class="w"> </span>/tests/smoke<span class="w"> </span>--link<span class="w"> </span>foo
$<span class="w"> </span>tmt<span class="w"> </span><span class="nb">test</span><span class="w"> </span>create<span class="w"> </span>/tests/smoke<span class="w"> </span>--link<span class="w"> </span>foo<span class="w"> </span>--link<span class="w"> </span>verifies:https://foo.com/a/b/c
</code></pre></div>
<p>In a similar way, the <code>tmt plan create</code> command can be used to
create a new plan with templates:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>plan<span class="w"> </span>create<span class="w"> </span>--template<span class="w"> </span>mini<span class="w"> </span>/plans/smoke
tmt<span class="w"> </span>plan<span class="w"> </span>create<span class="w"> </span>-t<span class="w"> </span>full<span class="w"> </span>/plans/features
</code></pre></div>
<p>When creating many plans, for example when migrating the whole
test coverage from a different tooling, it might be handy to
override default template content directly from the command line.
For this use individual step options such as <code>--discover</code> and
provide desired data in the <code>yaml</code> format:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>plan<span class="w"> </span>create<span class="w"> </span>/plans/custom<span class="w"> </span>--template<span class="w"> </span>mini<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--discover<span class="w"> </span><span class="s1">&#39;{how: &quot;fmf&quot;, name: &quot;internal&quot;, url: &quot;https://internal/repo&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--discover<span class="w"> </span><span class="s1">&#39;{how: &quot;fmf&quot;, name: &quot;external&quot;, url: &quot;https://external/repo&quot;}&#39;</span>
</code></pre></div>
<p>Now it will be no surprise for you that for creating a new story
the <code>tmt story create</code> command can be used with the very same
possibility to choose the right template:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>story<span class="w"> </span>create<span class="w"> </span>--template<span class="w"> </span>full<span class="w"> </span>/stories/usability
</code></pre></div>
<p>Sometimes you forget something, or just things may go wrong and
you need another try. In such case add <code>-f</code> or <code>--force</code> to
quickly overwrite existing files with the right content.</p>
<h3 id="custom-templates">Custom Templates<a class="headerlink" href="#custom-templates" title="Permanent link">&para;</a></h3>
<p>If you create new tests often, you might want to create a custom
template in order to get quickly started with a new test skeleton
tailored exactly to your needs. The same applies for plans and
stories.</p>
<p>Templates can be defined inside the config directory
<code>TMT_CONFIG_DIR</code> under the <code>templates</code> subdirectory. If the
config directory is not explicitly set, the default config
directory <code>~/.config/tmt/templates</code> is used. Use the following
directory structure when creating custom templates:</p>
<ul>
<li><code>~/.config/tmt/templates/story</code> for story metadata</li>
<li><code>~/.config/tmt/templates/plan</code> for plan metadata</li>
<li><code>~/.config/tmt/templates/test</code> for test metadata</li>
<li><code>~/.config/tmt/templates/script</code> for test scripts</li>
</ul>
<p>We use Jinja for templates, so your template files must have the
<code>.j2</code> file extension. You can also apply default Jinja filters
to your templates.</p>
<p>To use your custom templates, use the <code>--template</code> option with
your template name. For example, if you have created a
<code>feature.j2</code> story template:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>stories<span class="w"> </span>create<span class="w"> </span>--template<span class="w"> </span>feature<span class="w"> </span>/stories/download
tmt<span class="w"> </span>stories<span class="w"> </span>create<span class="w"> </span>-t<span class="w"> </span>feature<span class="w"> </span>/stories/upload
</code></pre></div>
<p>In the very same way you can create your custom templates for new
plans and tests. Tests are a bit special as they also need a
script template in addition to the test metadata. By default, both
test metadata and test script use the same template name, so for a
<code>web</code> template the command line would look like this:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>tests<span class="w"> </span>create<span class="w"> </span>--template<span class="w"> </span>web<span class="w"> </span>/tests/server
tmt<span class="w"> </span>tests<span class="w"> </span>create<span class="w"> </span>-t<span class="w"> </span>web<span class="w"> </span>/tests/client
</code></pre></div>
<p>If you want to use a different template for the test script, use
the <code>--script</code> option. For example, it might be useful to have
a separate <code>multihost.j2</code> template for complex scenarios where
multiple guests are involved:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>tests<span class="w"> </span>create<span class="w"> </span>--template<span class="w"> </span>web<span class="w"> </span>--script<span class="w"> </span>multihost<span class="w"> </span>/tests/download
tmt<span class="w"> </span>tests<span class="w"> </span>create<span class="w"> </span>-t<span class="w"> </span>web<span class="w"> </span>-s<span class="w"> </span>multihost<span class="w"> </span>/tests/upload
</code></pre></div>
<p>Sometimes it might be useful to maintain common templates on a
single place and share them across the team. To use a remote
template just provide the URL to the <code>--template</code> option. If you
want to use a custom remote template for tests, you need to use
both <code>--template</code> and <code>--script</code> options. For example:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>tests<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--template<span class="w"> </span>https://team.repo/web.j2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--script<span class="w"> </span>https://team.repo/multihost.j2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/tests/download
</code></pre></div>
<h3 id="lint">Lint<a class="headerlink" href="#lint" title="Permanent link">&para;</a></h3>
<p>It is easy to introduce a syntax error to one of the fmf files and
make the whole tree broken. The <code>tmt lint</code> command performs a
set of <code>lint-checks</code> which compare the stored metadata
against the specification and reports anything suspicious:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tmt<span class="w"> </span>lint<span class="w"> </span>/tests/execute/basic
/tests/execute/basic
pass<span class="w"> </span>C000<span class="w"> </span>fmf<span class="w"> </span>node<span class="w"> </span>passes<span class="w"> </span>schema<span class="w"> </span>validation
warn<span class="w"> </span>C001<span class="w"> </span>summary<span class="w"> </span>should<span class="w"> </span>not<span class="w"> </span>exceed<span class="w"> </span><span class="m">50</span><span class="w"> </span>characters
pass<span class="w"> </span>T001<span class="w"> </span>correct<span class="w"> </span>keys<span class="w"> </span>are<span class="w"> </span>used
pass<span class="w"> </span>T002<span class="w"> </span><span class="nb">test</span><span class="w"> </span>script<span class="w"> </span>is<span class="w"> </span>defined
pass<span class="w"> </span>T003<span class="w"> </span>directory<span class="w"> </span>path<span class="w"> </span>is<span class="w"> </span>absolute
pass<span class="w"> </span>T004<span class="w"> </span><span class="nb">test</span><span class="w"> </span>path<span class="w"> </span><span class="s1">&#39;/home/psss/git/tmt/tests/execute/basic&#39;</span><span class="w"> </span>does<span class="w"> </span>exist
skip<span class="w"> </span>T005<span class="w"> </span>legacy<span class="w"> </span>relevancy<span class="w"> </span>not<span class="w"> </span>detected
skip<span class="w"> </span>T006<span class="w"> </span>legacy<span class="w"> </span><span class="s1">&#39;coverage&#39;</span><span class="w"> </span>field<span class="w"> </span>not<span class="w"> </span>detected
skip<span class="w"> </span>T007<span class="w"> </span>not<span class="w"> </span>a<span class="w"> </span>manual<span class="w"> </span><span class="nb">test</span>
skip<span class="w"> </span>T008<span class="w"> </span>not<span class="w"> </span>a<span class="w"> </span>manual<span class="w"> </span><span class="nb">test</span>
pass<span class="w"> </span>T009<span class="w"> </span>all<span class="w"> </span>requirements<span class="w"> </span>have<span class="w"> </span><span class="nb">type</span><span class="w"> </span>field
</code></pre></div>
<p>There is a broad variety of options to control what checks are
applied on tests, plans and stories:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Lint everything, everywhere</span>
tmt<span class="w"> </span>lint

<span class="c1"># Lint just selected plans</span>
tmt<span class="w"> </span>lint<span class="w"> </span>/plans/features
tmt<span class="w"> </span>plans<span class="w"> </span>lint<span class="w"> </span>/plans/features

<span class="c1"># Change the set of checks applied - enable some, disable others</span>
tmt<span class="w"> </span>lint<span class="w"> </span>--enable-check<span class="w"> </span>T001<span class="w"> </span>--disable-check<span class="w"> </span>C002
</code></pre></div>
<p>See the <code>lint-checks</code> page for the list of available checks
or use the <code>--list-checks</code> option. For the full list of options,
see <code>tmt lint --help</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># All checks tmt has for tests, plans and stories</span>
tmt<span class="w"> </span>lint<span class="w"> </span>--list-checks

<span class="c1"># All checks tmt has for tests</span>
tmt<span class="w"> </span>tests<span class="w"> </span>lint<span class="w"> </span>--list-checks
</code></pre></div>
<p>You should run <code>tmt lint</code> before pushing changes, ideally even
before you commit your changes. You can set up <a href="https://pre-commit.com/#install">pre-commit</a> to
do it for you. Add to your repository's <code>.pre-commit-config.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/teemtee/tmt.git</span>
<span class="w">  </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.29.0</span>
<span class="w">  </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt-lint</span>
</code></pre></div>
<p>This will run <code>tmt lint --source</code> for all modified fmf files.
There are hooks to just check tests <code>tmt-tests-lint</code>, plans
<code>tmt-plans-lint</code> or stories <code>tmt-stories-lint</code> explicitly.
From time to time you might want to run <code>pre-commit autoupdate</code>
to refresh config to the latest version.</p>
<h3 id="inheritance">Inheritance<a class="headerlink" href="#inheritance" title="Permanent link">&para;</a></h3>
<p>The <code>fmf</code> format provides a nice flexibility regarding the file
location. Tests, plans and stories can be placed arbitrarily in
the repo. You can pick the location which best fits your project.
However, it makes sense to group similar or closely related
objects together. A thoughtful structure will not only make it
easier to find things and more quickly understand the content, it
also allows to prevent duplication of common metadata which would
be otherwise repeated many times.</p>
<p>Let's have a look at some tangible example. We create separate
directories for tests and plans. Under each of them there is an
additional level to group related tests or plans together:</p>
<div class="highlight"><pre><span></span><code>├── plans
│   ├── features
│   ├── install
│   ├── integration
│   ├── provision
│   ├── remote
│   └── sanity
└── tests
    ├── core
    ├── full
    ├── init
    ├── lint
    ├── login
    ├── run
    ├── steps
    └── unit
</code></pre></div>
<p>Vast majority of the tests is executed using a <code>./test.sh</code>
script which is written in <code>beakerlib</code> framework and almost all
tests require <code>tmt</code> package to be installed on the system. So
the following test metadata are common:</p>
<div class="highlight"><pre><span></span><code><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test.sh</span>
<span class="nt">framework</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">beakerlib</span>
<span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">tmt</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Instead of repeating this information again and again for each test
we place a <code>main.fmf</code> file at the top of the <code>tests</code> tree:</p>
<div class="highlight"><pre><span></span><code>tests
├── main.fmf
├── core
├── full
├── init
...
</code></pre></div>
<h4 id="virtual-tests">Virtual Tests<a class="headerlink" href="#virtual-tests" title="Permanent link">&para;</a></h4>
<p>Sometimes it might be useful to reuse test code by providing
different parameter or an environment variable to the same test
script. In such cases inheritance allows to easily share the
common setup:</p>
<div class="highlight"><pre><span></span><code><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test.sh</span>
<span class="nt">require</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl</span>

<span class="nt">/fast</span><span class="p">:</span>
<span class="w">    </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Quick smoke test</span>
<span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">        </span><span class="nt">MODE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fast</span>

<span class="nt">/full</span><span class="p">:</span>
<span class="w">    </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Full test set</span>
<span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">        </span><span class="nt">MODE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
</code></pre></div>
<p>In the example above, two tests are defined, both executing the
same <code>test.sh</code> script but providing a different environment
variable which instructs the test to perform a different set of
actions.</p>
<h4 id="inherit-plans">Inherit Plans<a class="headerlink" href="#inherit-plans" title="Permanent link">&para;</a></h4>
<p>If several plans share similar content it is possible to use
inheritance to prevent unnecessary duplication of the data:</p>
<div class="highlight"><pre><span></span><code><span class="nt">discover</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/teemtee/tmt</span>
<span class="nt">prepare</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">    </span><span class="nt">playbook</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible/packages.yml</span>
<span class="nt">execute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt</span>

<span class="nt">/basic</span><span class="p">:</span>
<span class="w">    </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Quick set of basic functionality tests</span>
<span class="w">    </span><span class="nt">discover+</span><span class="p">:</span>
<span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tier:1</span>

<span class="nt">/features</span><span class="p">:</span>
<span class="w">    </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Detailed tests for individual features</span>
<span class="w">    </span><span class="nt">discover+</span><span class="p">:</span>
<span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tier:2</span>
</code></pre></div>
<p>Note that a <code>+</code> sign should be used if you want to extend the
parent data instead of replacing them. See the <a href="https://fmf.readthedocs.io/en/latest/features.html">fmf features</a>
documentation for a detailed description of the hierarchy,
inheritance and merging attributes.</p>
<h3 id="elasticity">Elasticity<a class="headerlink" href="#elasticity" title="Permanent link">&para;</a></h3>
<p>Depending on the size of your project you can choose to store all
configuration in just a single file or rather use multiple files
to store each test, plan or story separately. For example, you can
combine both the plan and tests like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">/plan</span><span class="p">:</span>
<span class="w">    </span><span class="nt">summary</span><span class="p">:</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">Verify that plugins are working</span>
<span class="w">    </span><span class="nt">discover</span><span class="p">:</span>
<span class="w">        </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">provision</span><span class="p">:</span>
<span class="w">        </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>
<span class="w">    </span><span class="nt">prepare</span><span class="p">:</span>
<span class="w">        </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>
<span class="w">        </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did</span>
<span class="w">    </span><span class="nt">execute</span><span class="p">:</span>
<span class="w">        </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt</span>

<span class="nt">/tests</span><span class="p">:</span>
<span class="w">    </span><span class="nt">/bugzilla</span><span class="p">:</span>
<span class="w">        </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --bugzilla</span>
<span class="w">    </span><span class="nt">/github</span><span class="p">:</span>
<span class="w">        </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --github</span>
<span class="w">    </span><span class="nt">/koji</span><span class="p">:</span>
<span class="w">        </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --koji</span>
</code></pre></div>
<p>Or you can put the plan in one file and tests into another one:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># plan.fmf</span>
<span class="nt">summary</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">Verify that plugins are working</span>
<span class="nt">discover</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="nt">provision</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>
<span class="nt">prepare</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">install</span>
<span class="w">    </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did</span>
<span class="nt">execute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmt</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests.fmf</span>
<span class="nt">/bugzilla</span><span class="p">:</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --bugzilla</span>
<span class="nt">/github</span><span class="p">:</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --github</span>
<span class="nt">/koji</span><span class="p">:</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --koji</span>
</code></pre></div>
<p>Or even each test can be defined in a separate file:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/bugzilla.fmf</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --bugzilla</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/github.fmf</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --github</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/koji.fmf</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --koji</span>
</code></pre></div>
<p>You can start with a single file when the project is still small.
When some branch of the config grows too much, you can easily
extract the large content into a new separate file.</p>
<p>The <code>tree</code> built from the scattered files stay identical if
the same name is used for the file or directory containing the
data. For example, the <code>/tests/koji</code> test from the top
<code>main.fmf</code> config could be moved to any of the following
locations without any change to the resulting <code>fmf</code> tree:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># tests.fmf</span>
<span class="nt">/koji</span><span class="p">:</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --koji</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/main.fmf</span>
<span class="nt">/koji</span><span class="p">:</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --koji</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/koji.fmf</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --koji</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/koji/main.fmf</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">did --koji</span>
</code></pre></div>
<p>This gives you a nice flexibility to extend the metadata when and
where needed as your project organically grows.</p>
<h3 id="link-issues">Link Issues<a class="headerlink" href="#link-issues" title="Permanent link">&para;</a></h3>
<p>You can link issues to the test or plan that covers it. This can
be done either directly during creation of a new test or plan, or
later using the <code>tmt link</code> command:</p>
<div class="highlight"><pre><span></span><code>tmt<span class="w"> </span>link<span class="w"> </span>--link<span class="w"> </span>verifies:https://issues.redhat.com/browse/YOUR-ISSUE<span class="w"> </span>tests/core/smoke
</code></pre></div>
<p>In order to enable this feature, create a configuration file
<code>.config/tmt/link.fmf</code> and define an <code>issue-tracker</code> section
there. Once the configuration is present, it enables the linking
on its own, no further action is needed. The section should have
the following format:</p>
<div class="highlight"><pre><span></span><code><span class="nt">issue-tracker</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jira</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://issues.redhat.com</span>
<span class="w">    </span><span class="nt">tmt-web-url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://tmt.testing-farm.io/</span>
<span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;YOUR_PERSONAL_JIRA_TOKEN&gt;</span>
</code></pre></div>
<p>The <code>type</code> key specifies the type of the issue tracking service
you want to link to (so far only Jira is supported). The <code>url</code>
is the URL of said service. The <code>tmt-web-url</code> is the URL of the
service that presents tmt metadata in a human-readable form. The
<code>token</code> is a personal token that is used to authenticate the
user. How to obtain this token is described <a href="https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/#Create-an-API-token">here</a>
(please note that this can vary if you use custom Jira instance).</p>
<p>Once the link is attached to the respective Jira, clicking on it
will take you to the tmt web service with test or plan details.
Here's an example <a href="https://tmt.testing-farm.io/?test-url=https%3A%2F%2Fgithub.com%2Fteemtee%2Ftmt.git&amp;test-name=%2Ftests%2Fcore%2Fescaping&amp;test-ref=main">test</a> and <a href="https://tmt.testing-farm.io/?plan-url=https%3A%2F%2Fgithub.com%2Fteemtee%2Ftmt.git&amp;plan-name=%2Fplans%2Ffeatures%2Fcore&amp;plan-ref=main">plan</a>. It is also possible to
reference both <a href="https://tmt.testing-farm.io/?test-url=https%3A%2F%2Fgithub.com%2Fteemtee%2Ftmt.git&amp;test-name=%2Ftests%2Fcore%2Flink&amp;test-ref=main&amp;plan-url=https%3A%2F%2Fgithub.com%2Fteemtee%2Ftmt.git&amp;plan-name=%2Fplans%2Ffeatures%2Fcore&amp;plan-ref=main">test and plan</a> in a single link.</p>
<h3 id="share-tests">Share Tests<a class="headerlink" href="#share-tests" title="Permanent link">&para;</a></h3>
<p>Tests can be shared across different repositories, significantly
enhancing efficiency, reducing data duplication, and improving
maintainability in the testing workflow.</p>
<p>tmt allows references to external repositories directly within the
<code>discover</code> step of the plan. By specifying the URL of a remote
git repository, tmt can fetch and integrate tests defined within
that repository.</p>
<div class="highlight"><pre><span></span><code><span class="nt">discover</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Fetch common tests from a shared repository</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">core-tests</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/my-org/core-tests.git</span>

<span class="w">  </span><span class="c1"># Discover tests located within this project&#39;s own repository</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">project-specific</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
</code></pre></div>
<h3 id="adjust-metadata">Adjust Metadata<a class="headerlink" href="#adjust-metadata" title="Permanent link">&para;</a></h3>
<p>Sometimes metadata needs to be adjusted based on the context.
For example, the user might want to enable a test only for a
specific architecture or skip a plan when running in a container.
The core attribute <code>/spec/core/adjust</code> provides a flexible
way to achieve this. It allows to modify various attributes of
the tests, plans, or stories depending on the current
<code>/spec/context</code>.</p>
<p>This feature helps with creating adaptable and reusable metadata,
reducing the need for multiple versions of similar configurations.
Rules can be defined to conditionally change attributes
like <code>enabled</code>, <code>environment</code>, <code>require</code> or even the
test script itself.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Disable a test for older distros</span>
<span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">adjust</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">distro &lt; fedora-33</span>
<span class="w">    </span><span class="nt">because</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">the feature was added in Fedora 33</span>
</code></pre></div>
<h3 id="anchors-and-aliases">Anchors and Aliases<a class="headerlink" href="#anchors-and-aliases" title="Permanent link">&para;</a></h3>
<p>When you need to specify the same variable multiple times in a
single file, the <code>yaml</code> feature called <a href="https://yaml.org/spec/1.2.2/#3222-anchors-and-aliases">Anchors and Aliases</a>
can come handy. You can define an anchor before an item to save
it for future usage with an <code>alias</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example of an anchor:</span>
<span class="nt">discover</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;stable</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">first</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">second</span>

<span class="c1"># Which you can then use later in the same file as an alias:</span>
<span class="nt">discover</span><span class="p">:</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="nv">*stable</span>
</code></pre></div>
<h3 id="git-metadata">Git Metadata<a class="headerlink" href="#git-metadata" title="Permanent link">&para;</a></h3>
<p>In order to save space and bandwidth, the <code>.git</code> directory is
not synced to the guest by default. If you want to have it
available, use the respective <code>discover</code> step option to have it
copied to the guest.</p>
<div class="highlight"><pre><span></span><code><span class="nt">discover</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Keep git for fmf discovery</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">sync-repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nt">discover</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Keep git for shell discovery</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shell</span>
<span class="w">    </span><span class="nt">keep-git-metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Git metadata cannot be copied for the <code>prepare</code> or
<code>finish</code> steps yet.</p>
</div>
<h3 id="conditional-step-configuration">Conditional step configuration<a class="headerlink" href="#conditional-step-configuration" title="Permanent link">&para;</a></h3>
<p>Sometimes, the plan is expected to cover a broad set of environments;
however, some step configurations may not be applicable everywhere.
While <code>/spec/core/adjust</code> can be used to construct the plan
in this way, it soon becomes difficult to read.</p>
<p>Using the <code>when</code> key makes it easier to restrict a step configuration
to run only if any of the specified rules matches.
The syntax is the same as in <code>adjust</code> and <code>/spec/context</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">prepare</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prepare config to run only on Fedora</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">distro == fedora</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shell</span>
<span class="w">    </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./fedora_specific.sh</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Runs always</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shell</span>
<span class="w">    </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./setup.sh</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">More rules in &#39;when&#39; key</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shell</span>
<span class="w">    </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./something.sh</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arch != x86_64</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">initiator == human &amp;&amp; distro == fedora</span>
</code></pre></div>
<h2 id="multihost-testing">Multihost Testing<a class="headerlink" href="#multihost-testing" title="Permanent link">&para;</a></h2>
<p>Support for basic server/client scenarios is now available.</p>
<p>The <code>prepare</code>, <code>execute</code>, and <code>finish</code> steps are able to run a
given task (test, preparation script, ansible playbook, etc.) on
several guests at once. Tasks are assigned to provisioned guests by
matching the <code>where</code> key from
<code>discover&lt;/spec/plans/discover/where&gt;</code>,
<code>prepare&lt;/spec/plans/prepare/where&gt;</code> and
<code>finish&lt;/spec/plans/finish/where&gt;</code>
phases with corresponding guests by their
<code>key and role keys&lt;/spec/plans/provision/multihost&gt;</code>.
Essentially, plan author tells tmt on which guest(s) a test or
script should run by listing guest name(s) or guest role(s).</p>
<p>The granularity of the multihost scenario is on the step phase
level. The user may define multiple <code>discover</code>, <code>prepare</code> and
<code>finish</code> phases, and everything in them will start on given guests
at the same time when the previous phase completes. The practical
effect is, tmt does not manage synchronization on the test level:</p>
<div class="highlight"><pre><span></span><code><span class="nt">discover</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server-setup</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tests/A</span>
<span class="w">    </span><span class="nt">where</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tests</span>
<span class="w">    </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fmf</span>
<span class="w">    </span><span class="nt">test</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tests/B</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tests/C</span>
<span class="w">    </span><span class="nt">where</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">client</span>
</code></pre></div>
<p>In this example, first, everything from the <code>server-setup</code> phase
would run on guests called <code>server</code>, while guests with the name or
role <code>client</code> would remain idle. When this phase completes, tmt
would move to the next one, and run everything in <code>tests</code> on
<code>server</code> and <code>client</code> guests. The phase would be started at the
same time, more or less, but tmt will not even try to synchronize
the execution of each test from this phase. <code>/tests/B</code> may still
be running on <code>server</code> when <code>/tests/C</code> is already completed on
<code>client</code>.</p>
<p>tmt exposes information about guests and roles to all three steps in
the form of files tests and scripts can parse or import.
See the <code>/spec/plans/guest-topology</code> for details. Information
from these files can be then used to contact other guests, connect
to their services, synchronization, etc.</p>
<p>tmt fully supports one test being executed multiple times. This is
especially visible in the format of results, see
<code>/spec/results</code>. Every test is assigned a "serial
number", if the same test appears in multiple discover phases, each
instance would be given a different serial number. The serial number
and the guest from which a result comes from are then saved for each
test result.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a well-mannered project, tmt of course has a battery of tests
to make sure the multihost support does not break down. The
<code>/tests/multihost/complete</code> test may serve as an inspiration
for your experiments.</p>
</div>
<h3 id="rerunning-failed-tests-of-previously-executed-runs">Rerunning failed tests of previously executed runs<a class="headerlink" href="#rerunning-failed-tests-of-previously-executed-runs" title="Permanent link">&para;</a></h3>
<p>Executing failed tests again after fixing them is now possible
with <code>tmt run --all --again tests --failed-only</code>.</p>
<p>This is only possible when you have the run directory available
and <code>--id</code> argument provided (or use <code>--last</code>) as it needs the data from
execute step to select only failed test cases. After new execute step,
tmt will again merge the results from the previous run with the new ones
to keep all the data for full report.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tmt<span class="w"> </span>run
<span class="c1"># Some tests fail, some pass</span>

$<span class="w"> </span>tmt<span class="w"> </span>run<span class="w"> </span>--last<span class="w"> </span>--again<span class="w"> </span>discover<span class="w"> </span>tests<span class="w"> </span>--failed-only
<span class="c1"># Discover tests to rerun</span>

$<span class="w"> </span>tmt<span class="w"> </span>run<span class="w"> </span>--all<span class="w"> </span>--last<span class="w"> </span>--again<span class="w"> </span>tests<span class="w"> </span>--failed-only
<span class="c1"># Run all failed tests again</span>
</code></pre></div>
<h3 id="synchronization-libraries">Synchronization Libraries<a class="headerlink" href="#synchronization-libraries" title="Permanent link">&para;</a></h3>
<p>The test-level synchronization, as described above, is not
implemented, and this is probably not going to change any time
soon. For the test-level synchronization, please use dedicated
libraries, e.g. one of the following:</p>
<ul>
<li><code>RHTS support</code> in Beaker <code>rhts-sync-block</code> and
    <code>rhts-sync-set</code>,</li>
<li><code>a beakerlib library</code> by Ondrej Moris, utilizes a shared
    storage, two-hosts only,</li>
<li><code>a rhts-like distributed version</code> by Karel Srot,</li>
<li><code>a native beakerlib library</code> by Dalibor Pospisil, a
    distributed version of Ondrej Moris's library, supporting any
    number of hosts.</li>
<li><code>redis server</code> by Jan Scotka, a simple key-value exchange
    solution between machines. The primary purpose is data
    transfer. It is not a library prepared for synchronization,
    but it's possible to use it as well. See the example to learn
    how to set up a redis server and use it.</li>
</ul>
<h3 id="current-limits">Current Limits<a class="headerlink" href="#current-limits" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the most up-to-date list of issues related to multihost,
our Github can display all issues with the <code>multihost</code> label.</p>
</div>
<ul>
<li>interaction between guests provisioned by different plugins. Think
    "a server from <code>podman</code> plugin vs client from <code>virtual</code>".
    This is not yet supported, see <a href="https://github.com/teemtee/tmt/issues/2047">this issue</a>.</li>
</ul>













              </article>
            </div>


<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>




      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>


      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>


  </body>
</html>